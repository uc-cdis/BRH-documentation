
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://brh.data-commons.org/nextflow-create-docker/">
      
      
        <link rel="prev" href="../nextflow-overview-containers/">
      
      
        <link rel="next" href="../nextflow-request-creds/">
      
      
      <link rel="icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.6">
    
    
      
        <title>Nextflow - Create Dockerfile - Biomedical Research Hub Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.35e1ed30.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="brh_platform" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#create-a-dockerfile" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Biomedical Research Hub Documentation" class="md-header__button md-logo" aria-label="Biomedical Research Hub Documentation" data-md-component="logo">
      
  <img src="../img/brh-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Biomedical Research Hub Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Nextflow - Create Dockerfile
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="brh_platform" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="brh_platform_dark" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 9a3 3 0 0 1 3 3 3 3 0 0 1-3 3 3 3 0 0 1-3-3 3 3 0 0 1 3-3m0-4.5c5 0 9.27 3.11 11 7.5-1.73 4.39-6 7.5-11 7.5S2.73 16.39 1 12c1.73-4.39 6-7.5 11-7.5M3.18 12a9.821 9.821 0 0 0 17.64 0 9.821 9.821 0 0 0-17.64 0Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/uc-cdis/BRH-documentation" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Biomedical Research Hub Documentation" class="md-nav__button md-logo" aria-label="Biomedical Research Hub Documentation" data-md-component="logo">
      
  <img src="../img/brh-logo.png" alt="logo">

    </a>
    Biomedical Research Hub Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/uc-cdis/BRH-documentation" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="https://brh.data-commons.org/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Return to BRH Platform
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../01-home/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    How to Get Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            How to Get Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../04-BRH_overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quickstart - BRH Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../05-workspace_registration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Workspace Page (Registration)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../06-loginoverview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Login Page
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../07-how_to_check_request_access/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Check Study Access and Authorize Resources
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../08-discovery_page/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Discovery Page
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../10-profile_page/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Profile Page
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Workspace User Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Workspace User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../09-workspace_page/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started in Workspace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../13-workspace_accounts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Workspace Accounts - Trial and Persistent Pay Models (STRIDES, Direct Pay)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../14-lauch_with_persistent_paymodel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch a Workspace with a Persistent Pay Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../15-monitor_compute_usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monitor Compute Usage in Persistent Pay Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../16-usage_exceeds_funding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    If Compute Usage Exceeds Funding
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../11-downloading_data_files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Downloading Data Files
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../17-workspace_faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Workspace FAQ
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Nextflow User Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Nextflow User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../nextflow-getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nextflow - Getting Started
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../nextflow-overview-containers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nextflow - Containers in Gen3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Nextflow - Create Dockerfile
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Nextflow - Create Dockerfile
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#start-with-a-security-validated-base-image" class="md-nav__link">
    Start with a security-validated base image
  </a>
  
    <nav class="md-nav" aria-label="Start with a security-validated base image">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-choose-your-base-image" class="md-nav__link">
    How to choose your base image
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verify-that-your-docker-and-docker-scout-are-working-as-expected" class="md-nav__link">
    Verify that your Docker and Docker Scout are working as expected
  </a>
  
    <nav class="md-nav" aria-label="Verify that your Docker and Docker Scout are working as expected">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-pulling-the-docker-image" class="md-nav__link">
    Test pulling the Docker image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-using-docker-scout-to-evaluate-image-vulnerabilities" class="md-nav__link">
    Test using Docker Scout to evaluate image vulnerabilities
  </a>
  
    <nav class="md-nav" aria-label="Test using Docker Scout to evaluate image vulnerabilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-docker-scout" class="md-nav__link">
    Run Docker Scout
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-your-image-locally-on-top-of-the-base-image" class="md-nav__link">
    Build your image locally on top of the base image
  </a>
  
    <nav class="md-nav" aria-label="Build your image locally on top of the base image">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unfamiliar-with-creating-dockerfiles" class="md-nav__link">
    Unfamiliar with creating Dockerfiles?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-build-an-image-with-a-dockerfile-and-a-requirementstxt" class="md-nav__link">
    Example: Build an image with a Dockerfile and a requirements.txt
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-examine-built-image-for-vulnerabilities" class="md-nav__link">
    Example: Examine built image for vulnerabilities
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#my-image-passes-the-local-security-scanning" class="md-nav__link">
    My image passes the local security scanning
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../nextflow-request-creds/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nextflow - Request Credentials
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../nextflow-upload-docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nextflow - Upload Docker Image
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../nextflow-tutorial-workflows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nextflow - Tutorials Workflows
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../02-types_of_shared_data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAIR Data
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../03-data_and_repos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Management and Repositories
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../12-contact/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contact
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#start-with-a-security-validated-base-image" class="md-nav__link">
    Start with a security-validated base image
  </a>
  
    <nav class="md-nav" aria-label="Start with a security-validated base image">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-choose-your-base-image" class="md-nav__link">
    How to choose your base image
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verify-that-your-docker-and-docker-scout-are-working-as-expected" class="md-nav__link">
    Verify that your Docker and Docker Scout are working as expected
  </a>
  
    <nav class="md-nav" aria-label="Verify that your Docker and Docker Scout are working as expected">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-pulling-the-docker-image" class="md-nav__link">
    Test pulling the Docker image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-using-docker-scout-to-evaluate-image-vulnerabilities" class="md-nav__link">
    Test using Docker Scout to evaluate image vulnerabilities
  </a>
  
    <nav class="md-nav" aria-label="Test using Docker Scout to evaluate image vulnerabilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-docker-scout" class="md-nav__link">
    Run Docker Scout
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-your-image-locally-on-top-of-the-base-image" class="md-nav__link">
    Build your image locally on top of the base image
  </a>
  
    <nav class="md-nav" aria-label="Build your image locally on top of the base image">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unfamiliar-with-creating-dockerfiles" class="md-nav__link">
    Unfamiliar with creating Dockerfiles?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-build-an-image-with-a-dockerfile-and-a-requirementstxt" class="md-nav__link">
    Example: Build an image with a Dockerfile and a requirements.txt
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-examine-built-image-for-vulnerabilities" class="md-nav__link">
    Example: Examine built image for vulnerabilities
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#my-image-passes-the-local-security-scanning" class="md-nav__link">
    My image passes the local security scanning
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<div><p><a href="https://www.nextflow.io/"><img alt="Nextflow logo" src="../img/nextflow.svg" style="height:75px"></a></p>
<h1 id="create-a-dockerfile"><strong>Create a Dockerfile</strong><a class="headerlink" href="#create-a-dockerfile" title="Permanent link">¶</a></h1>
<h3 id="overview"><strong>Overview</strong><a class="headerlink" href="#overview" title="Permanent link">¶</a></h3>
<p>This guide is for users who want to build Docker containers for use in Gen3 workspaces.</p>
<h3 id="prerequisites"><strong>Prerequisites</strong><a class="headerlink" href="#prerequisites" title="Permanent link">¶</a></h3>
<ul>
<li><a href="https://www.docker.com/get-started/">Docker Desktop</a> installed on your local machine <em>(note: Docker Desktop comes with Docker Scout, which will allow you to do your own preliminary security scanning before requesting credentials, so as to save you time. Strictly speaking, only the Docker CLI is required if you are willing to risk uploading without scanning.)</em></li>
<li>Docker Scout <em>(comes with Docker Desktop)</em> - required for scanning your built image before requesting credentials</li>
<li>Create a Docker account - also required for scanning your built image before requesting credentials <em>(when you sign in on Docker Desktop for the first time, you will be asked to create an account)</em></li>
<li>Clone or download the <a href="https://github.com/uc-cdis/bio-nextflow/tree/master"><code>bio-nextflow</code> repo</a></li>
</ul>
<h2 id="start-with-a-security-validated-base-image"><strong>Start with a security-validated base image</strong><a class="headerlink" href="#start-with-a-security-validated-base-image" title="Permanent link">¶</a></h2>
<p>Gen3 offers a collection of FedRAMP security-compliant base images. We re-assess these base images regularly for security compliance. Building on these base images makes it easier for your customized Docker image to pass the security scanning.</p>
<p>You can access the URLs to pull these images using Docker here:</p>
<p><a href="https://github.com/uc-cdis/containers/blob/master/nextflow-base-images/allowed_base_images.txt">https://github.com/uc-cdis/containers/blob/master/nextflow-base-images/allowed_base_images.txt</a></p>
<p><img alt="Screenshot of URLs for secure base images" src="../img/base-image-URLs.png"></p>
<p>Please note: if, when you click on <a href="https://github.com/uc-cdis/containers/blob/master/nextflow-base-images/allowed_base_images.txt">this link to the base image text file</a>, <strong>you see an asterisk next to one of these URLs, it means that the image is temporarily unavailable</strong> because it is being updated. Please wait until the asterisk is removed to build an image on that base image. If you would like an estimated timeframe for when the base image will be available, please ping us on Slack (<code>nextflow-support</code>).  </p>
<h3 id="how-to-choose-your-base-image"><strong>How to choose your base image</strong><a class="headerlink" href="#how-to-choose-your-base-image" title="Permanent link">¶</a></h3>
<p><strong>GPU vs. CPU</strong></p>
<p><em>Not sure what these are? <a href="https://blogs.nvidia.com/blog/whats-the-difference-between-a-cpu-and-a-gpu/">Here's a nice overview.</a></em></p>
<p>In our BRH Workspace, we offer workspace images for CPU and GPU tools. You can read more about this on our <a href="../nextflow-getting-started/#gpu-vs-cpu-nextflow-workspace-images">Getting Started page</a>. Choose the appropriate workspace image (CPU or GPU) for your Docker image and tools.</p>
<p><strong>GPU images</strong></p>
<p><strong>Note for May 2024 MIDRC testers: please be sure to choose the image using CUDA 11.8; even though it is described as "less preferred", it is the version that is compatible with the other tools you're using.</strong></p>
<p>We have 3 base images in our current selection that offer <a href="https://www.turing.com/kb/understanding-nvidia-cuda">CUDA</a> support for running on GPUs -- these have "cuda" in the image name, followed by the CUDA version. When possible, please choose the latest version of CUDA compatible with your tools.</p>
<blockquote>
<p>gen3-cuda-12.3-ubuntu22.04-openssl <em>(preferred)</em></p>
<p>gen3-cuda-12.3-torch2.2-ubuntu22.04-openssl <em>(also preferred)</em></p>
<p>gen3-cuda-11.8-ubuntu22.04-openssl <em>(only use if your tools require a lower version of CUDA)</em></p>
</blockquote>
<p><strong>CPU images</strong></p>
<p>We have one base image that is available for running workflows on CPUs.</p>
<blockquote>
<p>amazonlinux-base</p>
</blockquote>
<h2 id="verify-that-your-docker-and-docker-scout-are-working-as-expected">Verify that your Docker and Docker Scout are working as expected<a class="headerlink" href="#verify-that-your-docker-and-docker-scout-are-working-as-expected" title="Permanent link">¶</a></h2>
<p>Before you take the time to build your own Dockerfile, it's good to be sure your Docker is able to pull the base image of interest and that you are able to scan with Docker Scout. Doing these tests will be quite quick, and will help you identify problems more easily than if you try to troubleshoot problems in a build. This is also a good opportunity to verify that your selected base image has not accumulated any vulnerabilities since we last scanned it.</p>
<h3 id="test-pulling-the-docker-image"><strong>Test pulling the Docker image</strong><a class="headerlink" href="#test-pulling-the-docker-image" title="Permanent link">¶</a></h3>
<p>This will help make sure you can pull the base image of interest by running the <code>docker pull</code> commmand in your terminal, as described below.</p>
<p>First, open your Docker Desktop application (just to be sure Docker is running).</p>
<p>Next, open your terminal. Run <code>docker pull &lt;image URL&gt;</code>, where the image URL is the full line as displayed in the <a href="https://github.com/uc-cdis/containers/blob/master/nextflow-base-images/allowed_base_images.txt">file of security-validated base images</a>. If it's working, you will see language that it is pulling (see below). When it's complete (and successfully pulled), there will be a line that says <code>Status: Downloaded &lt;image&gt;</code> (see yellow highlight below). If you see this, you know that all the steps necessary to pull your image work. If you don't see this, reach out to us on Slack (<code>nextflow-support</code>, do not use <code>@</code>)</p>
<p><img alt="Test docker pull command in terminal" src="../img/test-docker-pull.png"></p>
<h3 id="test-using-docker-scout-to-evaluate-image-vulnerabilities"><strong>Test using Docker Scout to evaluate image vulnerabilities</strong><a class="headerlink" href="#test-using-docker-scout-to-evaluate-image-vulnerabilities" title="Permanent link">¶</a></h3>
<p>At the end of your test pull, Docker offers a suggestion to use Docker Scout to examine your image for vulnerabilities (see red box above). Since you will want to use Docker Scout to evaluate your custom build later, now is a convenient time to test this tool and make sure you are fully set up to run Docker Scout. Although we do not expect the base images to have any security problems, it's most efficient to run this quick check before you spend time building on this image, in case it has accumulated a vulnerability since we last scanned it.  </p>
<p><em>Note: If you don't seem to have access to Docker Scout, check whether you're using the <a href="#prerequisites">latest Docker version</a>.</em></p>
<h4 id="run-docker-scout"><strong>Run Docker Scout</strong><a class="headerlink" href="#run-docker-scout" title="Permanent link">¶</a></h4>
<p>To run Docker Scout, you must:</p>
<ul>
<li>have Docker running (for example, the desktop application open)</li>
<li>be signed in to Docker (in the desktop application, there is a Sign In button in the upper right corner)</li>
<li>have created a Docker account (when you sign in for the first time, you will be asked to create an account).</li>
</ul>
<p>Once you are signed in to Docker, you can run the command they suggest after pulling an image (for example, see the command in blue text in the red box above, <code>docker scout quickview &lt;image URL&gt;</code>). If the command runs successfully, you should see output similar to the screenshot below. This is a summary of the vulnerabilities in your image.</p>
<p><img alt="Test Docker Scout command in terminal" src="../img/scout-quickview.png"></p>
<p>You can run the next suggested command (shown in red box above, <code>docker scout cves...</code>) to see the full list of vulnerabilities.</p>
<p><strong>Images should be able to pass Gen3 security scanning if there are no Critical vulnerabilities.</strong>  </p>
<p><em>But please note: The unfortunate nature of vulnerabilities is that there are always new ones appearing, despite our active monitoring. If you do see that one of our base images has a Critical vulnerability reported by Docker Scout, please alert us on Slack (<code>nextflow-support</code>)</em></p>
<p><em>Want to know more about Docker Scout? <a href="https://docs.docker.com/scout/quickstart/">Check out the documentation</a>.</em></p>
<h2 id="build-your-image-locally-on-top-of-the-base-image"><strong>Build your image locally on top of the base image</strong><a class="headerlink" href="#build-your-image-locally-on-top-of-the-base-image" title="Permanent link">¶</a></h2>
<p>To build your own image, you need to create a Dockerfile. <em>(Reminder: Dockerfiles are typically named just "Dockerfile" - with a capital D and no file extension.)</em> To build your image on a base image, the first line of the Dockerfile should reference the base image tag. The Dockerfile you create typically lives in the Git repository where you have your code to make it easier to copy into your container.  </p>
<p><strong>Important note: Users on Macs with an M1 or M2 chip</strong> MUST build the Docker image using a platform flag so it can be run in Batch. <em>(If you are not using an M1/M2 chip, you can also use this command, although you do not have to if you prefer a more typical build command.)</em> This command will set the appropriate target platform for <code>build</code> so your image can be used in Batch:  </p>
<p><code>docker buildx build --pull --platform linux/amd64 .</code></p>
<p><em>(note the <code>.</code> at the end of the command)</em></p>
<p><em>The <code>--pull</code> part of the command will ensure you are always pulling a fresh version of the base image, and not using any cached images from previous builds that may now have vulnerabilities.</em></p>
<p><em>You can read more about this platform flag and building for a platform <a href="https://docs.docker.com/reference/cli/docker/buildx/build/#platform">here</a> and <a href="https://docs.docker.com/build/building/multi-platform/">here</a>.</em></p>
<h3 id="unfamiliar-with-creating-dockerfiles"><strong>Unfamiliar with creating Dockerfiles?</strong><a class="headerlink" href="#unfamiliar-with-creating-dockerfiles" title="Permanent link">¶</a></h3>
<p>If you are unfamiliar with creating Dockerfiles, we encourage you to explore the <a href="https://medium.com/@anshita.bhasin/a-step-by-step-guide-to-create-dockerfile-9e3744d38d11">excellent tutorial here</a>, as well as review the <a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/">Dockerfile documentation here</a>, before you proceed.  </p>
<p>Note: Dockerfiles are typically named just "Dockerfile" - with a capital D and no file extension.</p>
<h3 id="example-build-an-image-with-a-dockerfile-and-a-requirementstxt"><strong>Example: Build an image with a Dockerfile and a requirements.txt</strong><a class="headerlink" href="#example-build-an-image-with-a-dockerfile-and-a-requirementstxt" title="Permanent link">¶</a></h3>
<p><em>Please note: Images built on any of the base images with CUDA can take 3 hours or more to completely build.</em>  </p>
<p>In our example here, we will have you build your image using a <code>requirements.txt</code> to identify the software tools you want to add to the base image, as well as a Dockerfile that pulls in the base image, adds the software tools specified in the requirements file, copies relevant code files, and establishes some setup parameters.</p>
<p>Our example will use the files in the <a href="https://github.com/uc-cdis/bio-nextflow/tree/master/nextflow_notebooks/containerized_gpu_workflows/torch_cuda_test">torch_cuda_test directory</a> of the bio-nextflow repository. You can review the <code>readme</code> file in this directory for more information. It is a simple example that will build up from our base image by adding PyTorch. The Nextflow script will ultimately use a Python script that checks the version of CUDA in the GPU instance and checks whether it is compatible with the version of PyTorch and CUDA available in the container.</p>
<p>First, in the terminal, navigate to the directory where you cloned the the <code>bio-nextflow</code> repository (see <a href="#prerequisites">Prerequisites section</a>). Next, navigate to where the downloaded Dockerfile and requirements.txt are located:</p>
<p><code>cd bio-nextflow/nextflow_notebooks/containerized_gpu_workflows/torch_cuda_test</code></p>
<blockquote>
<p>If you open the Dockerfile, note that the first line of the Dockerfile references the URL for one of our GPU base images. This is always how you will reference a base image -- with <code>FROM</code> and the URL.</p>
</blockquote>
<p>Then, run the Docker <code>build</code> command. For example:</p>
<p><code>docker buildx build --pull --platform linux/amd64 . -t my_docker</code>  </p>
<p>will tag the Dockerfile in the local directory with the tag <code>my_docker</code>, and build a Docker image using the Dockerfile.  </p>
<h3 id="example-examine-built-image-for-vulnerabilities"><strong>Example: Examine built image for vulnerabilities</strong><a class="headerlink" href="#example-examine-built-image-for-vulnerabilities" title="Permanent link">¶</a></h3>
<p>You now have a new Docker image built upon our security-compliant base image. To identify and address any security concerns in your customized image before submitting for upload, we encourage all users to locally scan their image for vulnerabilities using Docker Scout, as described <a href="#test-using-docker-scout-to-evaluate-image-vulnerabilities">in our test above</a>. Here, we have tagged our new image with <code>my_docker</code>. So, we would run the Docker Scout <code>quickview</code> command on the image using this command:</p>
<p><code>docker scout quickview my_docker</code></p>
<p>And to identify the specific vulnerabilities and recommendations, you would run:</p>
<p><code>docker scout cves my_docker</code></p>
<h3 id="my-image-passes-the-local-security-scanning"><strong>My image passes the local security scanning</strong><a class="headerlink" href="#my-image-passes-the-local-security-scanning" title="Permanent link">¶</a></h3>
<p>Once your custom image is security-compliant based on the analysis from Docker Scout, you are ready to request credentials to submit your Docker image for Gen3 security scanning.  </p>
<p>Local security scanning of your built images is highly recommended for the most efficient path to having your image available for use in Nextflow workflows. However, it is not absolutely required; you can submit images without first scanning them with Docker Scout. If you do not do local scanning, there is a higher chance that you will have to submit your custom-built images more than once.  </p>
<p><a href="../nextflow-request-creds/"><em>Continue to Request Credentials</em></a></p></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.indexes", "navigation.tracking"], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.aecac24b.min.js"></script>
      
    
  </body>
</html>