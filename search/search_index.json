{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Biomedical Research Hub Documentation","text":""},{"location":"#biomedical-research-hub-documentation","title":"Biomedical Research Hub Documentation","text":"<p>The Biomedical Research Hub (BRH) is a cloud-based and multifunctional web interface that provides a secure environment for discovery and analysis of scientific results and data. It is designed to serve users with a variety of objectives, backgrounds, and specialties.</p> <p>The BRH represents a dynamic Data Ecosystem that aggregates and hosts metadata from multiple resources to make data discovery and access easy for users.</p> <p>The platform provides a way to search and query over study metadata and varied data types, generated by different projects and organizations, and stored across multiple secure repositories.</p> <p>The BRH also offers a secure and cost-effective cloud-computing environment for data analysis, empowering collaborative research and development of new analytical tools. New workflows and results of analyses can be shared with the community.</p> <p>The BRH is powered by the open-source software \u201cGen3\u201d.</p> <p></p> <p>Gen3 was created by and is actively developed at the University of Chicago\u2019s Center for Translational Data Science (CTDS) with the aim of creating interoperable cloud-based data resources for the scientific research community.</p>"},{"location":"01-home/","title":"Home","text":""},{"location":"01-home/#biomedical-research-hub-documentation","title":"Biomedical Research Hub Documentation","text":"<p>The Biomedical Research Hub (BRH) is a cloud-based and multifunctional web interface that provides a secure environment for discovery and analysis of scientific results and data. It is designed to serve users with a variety of objectives, backgrounds, and specialties.</p> <p>The BRH represents a dynamic Data Ecosystem that aggregates and hosts metadata from multiple resources to make data discovery and access easy for users.</p> <p>The platform provides a way to search and query over study metadata and a range of data types, generated by different projects and organizations, and stored across multiple secure repositories.</p> <p>The BRH also offers a secure and cost-effective cloud-computing environment for data analysis, empowering collaborative research and development of new analytical tools. New workflows and results of analyses can be shared with the community.</p> <p>The BRH is powered by the open-source software \u201cGen3\u201d</p> <p></p> <p>Gen3 was created by and is actively developed at the University of Chicago\u2019s Center for Translational Data Science (CTDS) with the aim of creating interoperable cloud-based data resources for the scientific research community.</p>"},{"location":"02-types_of_shared_data/","title":"FAIR Data","text":""},{"location":"02-types_of_shared_data/#types-of-shared-data","title":"Types of Shared Data","text":"<p>The BRH provides secure access to study metadata from multiple resources (Data Commons) and will be the driving engine for new discovery. The types of data represented are varied and include scientific research across multiple disciplines.</p> <p>The BRH aims to make data more accessible by following the \"FAIR\" principles:</p> <p>Findable Researchers are provided an intuitive interface to search over metadata for all studies and related datasets. Each study and dataset will be assigned a unique, persistent identifier. Accessible</p> <p>Authenticated users can request and receive access to controlled-access data by data providers. Metadata can be accessed via an open API.</p> <p>Interoperable Data can be easily exported to various workspaces for analysis using a variety of software tools.</p> <p>Reusable Data can be easily reused to facilitate reproducibility of results, development and sharing of new tools, and collaboration between investigators.</p>"},{"location":"03-data_and_repos/","title":"Data Management and Repositories","text":""},{"location":"03-data_and_repos/#data-and-repositories","title":"Data and Repositories","text":"<p>The BRH securely exposes study metadata and data files stored on multiple FAIR repositories and Data Commons, i.e. data libraries or archives, to provide an easy way to connect different repositories on one single location.</p> <p>FAIR data repositories are traditionally a part of a larger institution/working group established for research, data archiving, and, to serve data users of that organization.</p> <p>As of March 2023, the list of currently shared resources/Data Commons on BRH includes:</p> <ul> <li>BioData Catalyst</li> <li>CRDC Cancer Imaging Data Commons</li> <li>CRDC Genomic Data Commons</li> <li>CRDC Integrated Canine Data Commons</li> <li>CRDC Proteomic Data Commons</li> <li>JCOIN</li> <li>MIDRC</li> </ul>"},{"location":"04-BRH_overview/","title":"Quickstart - BRH Overview","text":""},{"location":"04-BRH_overview/#brh-overview","title":"BRH Overview","text":"<p>You can get started with the Biomedical Research Hub by exploring the features described below.</p>"},{"location":"04-BRH_overview/#register-for-workspaces","title":"Register for Workspaces","text":"<p>Get a temporary free trial to BRH workspaces and simultaneously register for extended workspace access with NIH STRIDES</p> <p></p>"},{"location":"04-BRH_overview/#login-page","title":"Login Page","text":"<p>Log in here to unlock controlled-access data and workspace access with your credentials</p> <p></p>"},{"location":"04-BRH_overview/#check-study-access-and-authorize-external-data-resources","title":"Check Study Access and Authorize External Data Resources","text":"<p>Check study access and connect your account to other resources to access all studies for which you are authorized.</p> <p></p>"},{"location":"04-BRH_overview/#discovery-page","title":"Discovery Page","text":"<p>Discover datasets across multiple resources and export selected data files to the analysis workspace.</p> <p></p>"},{"location":"04-BRH_overview/#workspaces-page","title":"Workspaces Page","text":"<p>Access data across multiple resources and perform analyses in a secure, cloud-based environment</p> <p></p>"},{"location":"04-BRH_overview/#profile-page","title":"Profile Page","text":"<p>Review data access permissions and generate API credentials files used for programmatic access.</p> <p></p>"},{"location":"05-workspace_registration/","title":"Workspace Page (Registration)","text":""},{"location":"05-workspace_registration/#register-for-brh-workspace","title":"Register for BRH Workspace","text":"<p>To start exploring BRH Workspace right away, users can apply for a Temporary Trial Access. Extended access to BRH Workspace is granted using a persistent pay model workspace account (e.g., STRIDES or Direct Pay), which can be requested after trial access is provisioned. Please see below for more details.</p>"},{"location":"05-workspace_registration/#requesting-temporary-trial-access-to-brh-workspace","title":"Requesting Temporary Trial Access to BRH Workspace","text":"<p>For new users without workspace access, please follow these steps</p> <ol> <li>Login to BRH</li> <li>Click on the Workspace tab. That opens the Workspace Access Request form</li> <li> <p>Fill in the details and submit the form shown below.</p> <p></p> </li> <li> <p>The form should be completed only once. Following submission, users will see a success message and a link back to the Discovery page.</p> <p></p> </li> <li> <p>Users will receive an email notifying them that the request has been received.</p> </li> <li> <p>Users will receive another email notifying them that the temporary trial access request has been approved. They should then be able to access  workspaces on BRH. Please note that the timeline for this approval can be a few business days.</p> </li> </ol>"},{"location":"05-workspace_registration/#requesting-extended-access-to-brh-workspace-using-a-persistent-pay-model-eg-strides-direct-pay","title":"Requesting Extended Access to BRH Workspace using a Persistent Pay Model (e.g., STRIDES, Direct Pay)","text":"<p>Please Note: The process for granting access for a workspace account can take 2-4 weeks for NIH STRIDES, and a month for Direct Pay.</p> <p>Find instructions for funding workspace accounts with any of the persistent pay models on the Workspace Accounts page.</p>"},{"location":"06-loginoverview/","title":"Login Page","text":""},{"location":"06-loginoverview/#login-access-overview","title":"Login Access Overview","text":"<p>All users are able to browse the study metadata on the Discovery Page without logging in.</p> <p>Users will need to log in and obtain authorization (access) in order to:</p> <ul> <li>Access studies with controlled data</li> <li>Perform analyses in Workspaces</li> <li>Download data files and file manifests</li> <li>Run interactive tutorial notebooks in the Workspaces</li> </ul> <p>Start by visiting the login page (https://brh.data-commons.org/login).</p> <p></p> <ul> <li>Login from Google: You may login using any Google account credentials, or a G-suite enabled institutional email. This option may or may not be available depending on the institution or organization the user is associated with.</li> <li>Login via InCommons --&gt; NIH eRA: When selecting the NIH/eRA (electronic Research Administration) login using InCommons, you will need access permissions through the eRA Commons account.</li> </ul> <p>After successfully logging in, your username will appear in the upper right-hand corner of the page.</p>"},{"location":"07-how_to_check_request_access/","title":"Check Study Access and Authorize Resources","text":""},{"location":"07-how_to_check_request_access/#how-to-check-and-request-access","title":"How To Check and Request Access","text":"<p>Users can find out to which projects they have access to by navigating to the Discovery Page and by selecting through the column filters at the top of the table.</p>"},{"location":"07-how_to_check_request_access/#access-to-individual-studies","title":"Access to individual Studies","text":"<p>You can check access by clicking on a study in the Discovery Page, as shown below:</p> <p></p> <p>The Study Page will display access permissions in the top right corner. Click the \u201cPermalink\u201d button in the upper right to copy the link to the clipboard.</p> <p>If you have access, a green box will show \u201cYou have access to this study\u201d.</p> <p></p> <p>Access is displayed as a green box on top of each Study Page.</p> <p>Note: If you have access but cannot select the study to export to workspace, it is because the manifest is not yet available. Please use API for these cases.</p>"},{"location":"07-how_to_check_request_access/#authorize-to-gain-access-to-fair-enabled-repositoriesresources","title":"Authorize to Gain Access to FAIR-enabled Repositories/Resources","text":"<p>BRH securely provides access to data stored on multiple FAIR repositories, resources, and Data Commons.</p> <p>Users must authorize these resources on their account in order to:</p> <ol> <li>run Jupyter Notebooks that utilize data stored in various FAIR repositories.</li> <li>export data that is stored in FAIR repositories from the Discovery Page to the Workspaces.</li> <li>download data that is stored in FAIR repositories from the Discovery Page.</li> </ol> <p>In order to authorize access to these repositories and data commons, navigate to the Profile Page. Authorize the relevant commons by clicking on the buttons for the relevant commons (e.g., the Refresh or Authenticate buttons in the image shown below).</p> <p>Authorization needs to be renewed after 30 days, as indicated after \"Status: expires in [..] days\".</p> <p></p>"},{"location":"08-discovery_page/","title":"Discovery Page","text":""},{"location":"08-discovery_page/#discovery-page","title":"Discovery Page","text":"<p>The Discovery Page provides users a venue to search and find studies and datasets displayed on the Biomedical Research Hub. Users can browse through the publicly accessible study-level metadata without requiring authorization.</p> <p>Use text-based search, faceted search, and tags to rapidly and efficiently find relevant studies, discover new datasets across multiple resources, and easily export selected data files to the analysis workspace. Browse through datasets and study-level metadata and find studies using tags, advanced search, or the free text search field.</p> <p></p>"},{"location":"08-discovery_page/#search-features","title":"Search Features","text":"<p>On the Discovery page, several features help you navigate and refine your search.</p> <p></p> <ol> <li>Total number of studies: shows the number of studies the BRH is currently displaying.</li> <li>Total number of subjects: shows the number of subjects the BRH is currently displaying.</li> <li>Free Text Search: Use keywords or tags in the free-text-based search bar to find studies. The free-text search bar can be used to search for study name, ID number, Data Commons, or any keyword that is mentioned in the metadata of the study.</li> <li>Data Resources/Data Commons Tags: view these by selecting \"Study Characteristics\". Click on a tag to filter by a Data Resource/Data Commons. Selecting multiple tags works in an \"OR\" logic (e.g., \"find AnVIL OR BioData Catalyst studies\").</li> <li>Export Options: Login first to leverage the export options. Select one or multiple studies and download a file manifest or export the data files to a secure cloud environment \"Workspace\" to start your custom data analysis in Python or R.</li> <li>Data Availability: Filter on available, pending, and not-yet-available datasets.</li> <li>Studies: This table feature presents all current studies on BRH. Click on any study to show useful information about the study (metadata).</li> </ol>"},{"location":"08-discovery_page/#find-available-study-level-metadata","title":"Find available Study-level Metadata","text":"<p>Clicking on any study will display the available study-level and dataset metadata.</p> <p></p>"},{"location":"08-discovery_page/#find-accessible-datasets","title":"Find accessible Datasets","text":"<p>Users can select and filter studies from multiple resources and conduct analyses on the selected datasets in a workspace. Users can search but not interact with data they do not have access to. By selecting the data access button in the top right corner of the study page user access can be displayed. The Discovery Page will automatically update the list of studies that are accessible.</p>"},{"location":"09-workspace_page/","title":"Getting Started in Workspace","text":""},{"location":"09-workspace_page/#workspaces","title":"Workspaces","text":"<p>To use the workspace, users must register for workspace accounts to use the workspaces, as described on the Workspace Registration page.</p> <p>BRH workspaces are secure data analysis environments in the cloud that can access data from one or more data resources. By default, Workspaces include Jupyter notebooks, Python and R, but can be configured to host virtually any application, including analysis workflows, data processing pipelines, or data visualization apps.</p> <p>New to Jupyter? Learn more about the popular tool for data scientists on Jupyter.org (disclaimer: CTDS is not responsible for the content).</p>"},{"location":"09-workspace_page/#guideline-to-get-started-in-workspaces","title":"Guideline to get started in Workspaces","text":"<p>Once users have access to workspaces, use this guide below to get started with analysis work in workspaces.</p> <ol> <li> <p>Users need to log in via https://brh.data-commons.org/login to access workspaces.</p> </li> <li> <p>After navigating to https://brh.data-commons.org/workspace, users will discover a list of pre-configured virtual machine (VM) images, as shown below.</p> <p></p> <ul> <li>(Generic) Jupyter Notebook with R kernel: Choose this VM if you are familiar with setting up Python- or R-based Notebooks, or if you just exported one or multiple studies from the Discovery Page and want to start your custom analysis.</li> <li>Tutorial Notebooks: Explore our Jupyter Notebook tutorials written in Python or R, which pull data from various sources of the Biomedical Research Hub to leverage statistical programs and data analysis tools. These are excellent resources for code to pull and analyze data from BRH, and examples that illustrate the variety of data and analyses available through BRH.</li> </ul> </li> <li> <p>Click \u201cLaunch\u201d on any of the workspace options to spin up a copy of that VM. The status of launching the workspace is displayed after clicking on \u201cLaunch\u201d. Note: Launching the VM may take several minutes.</p> <p></p> </li> <li> <p>After launching, the home folders are displayed. One of these folders is the user's persistent drive (\"/pd\").</p> <p></p> </li> <li> <p>Select the /pd folder. New files or licenses should be saved in the the /pd directory if users need to access them after restarting the workspaces. Only files saved in the /pd directory will remain available after termination of a workspace session.</p> <p>[]</p> <ul> <li>Attention: Any personal files in the folder \u201cdata\u201d will be lost. Personal files in the directory /pd will persist.</li> <li>Do not save files in the \"data\" or \u201cdata/brh.data-commons.org\u201d folders.</li> <li>The folder \u201cbrh.data-commons.org\u201d in the \u201cdata\u201d folder will host the data files you have exported from the Discovery Page. Move these files to the /pd directory if you do not want to have to export them again.</li> <li>/pd has a capacity limit of 10GB.</li> </ul> </li> <li> <p>Start a new notebook under \u201cNotebook\u201d in the Launcher tab. Click the tiles in the launcher and choose between Python 3 or R Studio as the base programmatic language. Note: You can open and run multiple notebooks in your workspace. However, the generic, tutorial and nextflow workspace images are currently separate docker images, so there is no functionality to combine them or run nextflow in the tutorial or generic images. This may be available in the future, after further testing and development activities.</p> <p></p> </li> <li> <p>Experiment away! Code blocks are entered in cells, which can be executed individually or all at once. Code documentation and comments can also be entered in cells, and the cell type can be set to support Markdown.</p> <p>Results, including plots, tables, and graphics, can be generated in the workspace and downloaded as files.</p> </li> <li> <p>Do not forget to terminate your workspace once your work is finished. Unterminated workspaces continue to accrue computational costs. Note, that Workspaces automatically shut down after 90 minutes of idle time.</p> <p></p> </li> </ol> <p>Further reading: read more about how to download data files into the Workspaces here.</p>"},{"location":"09-workspace_page/#upload-save-and-download-filesnotebooks","title":"Upload, save, and download Files/Notebooks","text":"<p>Users can upload data files or Notebooks from the local machine to the home directory by clicking on \u201cUpload\u201d in the top left corner. Access the uploaded content in the Notebook (see below).</p> <p></p> <p>Then run in the cells, for example:</p> <p><code>import os</code></p> <p><code>import pandas as pd</code></p> <p><code>os.chdir('/data')</code></p> <p><code>demo_df = pd.read_csv('/this_is_a_demo.txt', sep='\\t')</code></p> <p><code>demo_df.head()</code></p> <p>Users can save the notebook by clicking \"File\" - \"Save as\", as shown below.</p> <p></p> <p>Users can download notebooks by clicking \"File\" - \"Download\", as shown below. Download the notebook, for example, as \".ipynb\".</p> <p></p>"},{"location":"09-workspace_page/#environments-languages-and-tools","title":"Environments, Languages, and Tools","text":"<p>The following environments are available in the workspaces:</p> <ul> <li> <p>Jupyter Lab</p> <p></p> </li> </ul> <p>The following programmatic languages are available in Jupyter Notebooks:</p> <ul> <li>R</li> <li>Python 3</li> </ul> <p>The following tools are available in Jupyter Notebooks:</p> <ul> <li>GitHub (read GitHub documentation)</li> </ul>"},{"location":"09-workspace_page/#python-3-and-r-in-jupyter","title":"Python 3 and R in Jupyter","text":"<p>Both Python 3 and R are available in Jupyter Notebooks.</p> <p>Users can expect to be able to use typical Python or R packages, such as PyPI or CRAN. For Python and R, users can start a new notebook with a tile under \"Notebook\", as shown below.</p> <p></p>"},{"location":"09-workspace_page/#automatic-workspace-shutdown","title":"Automatic Workspace Shutdown","text":"<p>Warning: When a BRH Workspace reaches the STRIDES Credits limit for STRIDES Credits Workspaces, or reaches the Hard Limit for STRIDES Grant Workspaces, the Workspace will be automatically terminated. Please be sure to save any work before reaching the STRIDES Credit or Hard Limit.</p> <p>Warning: Workspaces will also automatically shut down after 90 minutes of idle time. A pop-up window will remind users to navigate back to the workspaces page in order to save the data.</p> <p></p>"},{"location":"10-profile_page/","title":"Profile Page","text":""},{"location":"10-profile_page/#profile-page","title":"Profile Page","text":"<p>On the profile page users will find information regarding their access to projects, access to Gen3-specific tools (e.g. access to the Workspace), and the function to create API keys for credential downloads. API keys are necessary for the download of files using the Gen3 Python SDK.</p> <p>Users can view their study access and API keys can be viewed/created/downloaded on the Profile Page.</p> <p></p>"},{"location":"11-downloading_data_files/","title":"Downloading Data Files","text":""},{"location":"11-downloading_data_files/#downloading-data-files","title":"Downloading Data Files","text":"<p>Users can download data files for work in the provided Workspace. Utilizing workspaces leverages CTDS-owned python software development kit (SDK) as well as a cloud-based computing platform.</p> <p>Note: accessing data files requires linked access to all FAIR enabled repositories, as described here.</p>"},{"location":"11-downloading_data_files/#download-data-files-into-a-workspace-with-the-python-sdk","title":"Download Data Files into a Workspace with the Python SDK","text":"<p>Users can load data files from a manifest created on the Discovery Page directly into a Workspace. Below are the steps to do so.</p> <ol> <li> <p>Navigate to the Discovery Page. Link your accounts to FAIR repositories as described here.</p> </li> <li> <p>Find the study or studies of interest by using the search features or the list of accessible studies.</p> </li> <li> <p>Select the clickable boxes next to the studies. Click on \"Open in Workspace\", which will initiate the Workspace Launcher.</p> <p></p> </li> <li> <p>The Workspace will be prepared and the selected data will be made available via a manifest placed in a time/date stamped directory in the following path: pd/data/brh.data-commons.org/exported-manifest-(time/date stamp) Please do not navigate away from this page until the download is complete. Created directory may take several minutes to load.</p> <p></p> </li> <li> <p>Once loaded, users can navigate into the directory and access either the manifest or an automatically generated notebook (e.g., data.ipynb) with instructions to download the data. Users should note that the gen3-sdk is utilized in this notebook and directory to download data.</p> <p></p> </li> </ol>"},{"location":"12-contact/","title":"Contact","text":""},{"location":"12-contact/#contact-brh-support","title":"Contact BRH Support","text":"<p>Need help? Please contact our help desk - brhsupport@gen3.org</p>"},{"location":"13-workspace_accounts/","title":"Workspace Accounts - Trial and Persistent Pay Models (STRIDES, Direct Pay)","text":""},{"location":"13-workspace_accounts/#workspace-accounts-trial-and-persistent-pay-models-strides-direct-pay","title":"Workspace Accounts - Trial and Persistent Pay Models (STRIDES, Direct Pay)","text":""},{"location":"13-workspace_accounts/#four-different-pay-models-for-brh-workspace-accounts","title":"Four Different Pay Models for BRH Workspace Accounts","text":"<p>We have 4 different pay models for workspace accounts:</p> <ul> <li>Trial Access (free for user, limited to 2 months)</li> <li>OCC Direct Pay (persistent pay model paid by credit card through OCC Payment Portal)</li> <li>STRIDES Grant/Award Funded (persistent pay model paid by organizations with NIH grant funds)</li> <li>STRIDES Credits (persistent pay model paid directly by NIH)</li> </ul> <p>Instructions for requesting funding for each pay model are provided below.</p> <p>Please Note:</p> <ul> <li>The process for granting access for a workspace account can take 2-4 weeks for NIH STRIDES, and a month for Direct Pay, although it may also be faster.</li> <li>The account from each different paymodel will have its own workspace storage directory (<code>/pd</code>; read about <code>/pd</code> here); data is not shared between accounts with different funding types. However, you can import and export data among accounts as long as they are active and have funding.</li> </ul>"},{"location":"13-workspace_accounts/#request-trial-access","title":"Request Trial Access","text":"<p>Trial Access is granted for 2 months when you request access to the BRH Workspace page. The instructions for requesting workspace access are on the Workspace Registration page. Note that your trial access will become inactive as soon as you have a workspace account funded through a persistent paymodel.</p>"},{"location":"13-workspace_accounts/#requesting-funding-for-workspace-accounts-through-any-persistent-pay-model","title":"Requesting Funding for Workspace Accounts Through Any Persistent Pay Model","text":"<ol> <li> <p>Once they have access to the Workspace page, users can request a workspace account by first logging to BRH (#1), going to the Workspace page (#2), then clicking the Workspace Account Manager link (#3). Click \"Log in\" and \"Yes, I authorize\" to open the portal in a new tab.</p> <p></p> <p>Some STRIDES users may receive an invitation via email to register for an NIH STRIDES workspace account. These users can also click the link in the invitation email to get to the BRH Workspace Account Manager.</p> </li> <li> <p>In the BRH Workspace Account Manager, users can see their persistent workspace accounts and any available credits or funds in the accounts. If you only have trial access, you will not see any active accounts.</p> <p>To request a workspace account with a persistent paymodel, click the \"Request New Workspace\" button.</p> <p></p> </li> <li> <p>Choose from any of the 3 persistent pay model funding options: a) STRIDES Grant/Award Funded; b) STRIDES Credits; or c) OCC Direct Pay to request a funded workspace account.</p> <p></p> </li> </ol>"},{"location":"13-workspace_accounts/#occ-direct-pay-funded-workspace-account","title":"OCC Direct Pay Funded Workspace Account","text":"<p>The OCC Direct Pay form can be selected if a user wants to pay with a personal or organizational credit card. OCC Direct Pay only requires a valid credit card.</p> <p>Funding a workspace account with OCC Direct Pay has 2 major parts:</p> <ol> <li>Request BillingID</li> <li>Use BillingID to provision Direct Pay funds for the Workspace Account</li> </ol>"},{"location":"13-workspace_accounts/#request-billingid","title":"Request BillingID","text":"<p>Note: It can take up to a month to receive a BillingID if you act promptly to complete each step.</p> <ol> <li> <p>Go to https://payments.occ-data.org or click on the Payment Portal link (red arrow below) on the OCC Direct Pay tab for the workspace account request form.</p> <p></p> </li> <li> <p>Create an account for the OCC Payment Portal: Under Create Account, enter your email address and click \u201cRequest Token\u201d. Note: This should be the email address you use to log into BRH; Direct Pay is not currently compatible with ORCID login. If you already logged in with ORCID to request a workspace account, please log out and authenticate with either the InCommon or Google option. Please monitor this address, as relevant alerts will be sent here.</p> </li> <li>You will receive an email with a 6-digit token within a couple minutes of your request. It may go to spam, so watch the Spam folder, as well.</li> <li>Copy your token from your email. Paste it into the Enter Token field on the OCC Payment Portal. Click Sign In. (Note: You will be asked to enter a token at each log-in.)</li> <li> <p>Successful sign-in will open a Profile page for your account on the OCC Payment Portal. When you first create your account on the payment portal, you will not have any access requests.</p> <p></p> </li> <li> <p>Click the \u201crequest access\u201d button. The form shown below will open. Complete the form and click Submit.</p> <p></p> <p>For Role, indicate your role within your organization/institution. If you don't have an institutional affiliation, you can put \"independent data analyst\"</p> </li> <li> <p>Once the form is submitted, a message will appear indicating successful submission. You will also receive an email (again, check spam).</p> </li> <li>If you return to the Profile page in the OCC Payment Portal now, you\u2019ll see there is an active request in the table at the bottom. Click \u201cCheck Status\u201d to view progress on the steps toward final approval and provisioning of your request. You can view what happens at each stage of processing here: https://payments.occ-data.org/processing-stages/.</li> <li> <p>When you click Check Status, you can see the progress of your request. At first, you will see that they are processing your request (indicated by an orange color). Once OCC finishes processing your access request, you will receive 2 emails, and the progress tracker at the bottom will show that Submit Access Request is completed (green). Complete E-Doc is now colored orange. The first email indicates that your access request status has progressed, and the second email has a link to an electronic document.</p> <p>Important: Review the Agreement carefully to understand the terms.   PLEASE READ THIS DOCUMENT VERY CAREFULLY BEFORE SIGNING!   This document presents the terms governing how your Direct Pay funds will be allocated, among other things. Be sure you understand all the terms before you sign and submit.   If you have any questions or concerns about the terms and conditions, please email billing@occ-data.org before you sign. </p> <p>Once you submit the signed document, it could take up to 5 days to finish processing receipt of the signed document and update your progress tracker. You will receive an email when processing is complete.</p> <p>But, you will receive an email quickly confirming that the document has been signed and providing a link to download the signed document for your records. If you do not receive that within 5 minutes (be sure to check your spam folder), please return to the document and verify that you fully signed and submitted the document. Please save the document so you can reference it as needed.</p> </li> <li> <p>When your request has been fully approved, the \u201cReceived Approval\u201d step will be green, you\u2019ll receive an email, and your BillingID field will have been populated on the Profile page of the OCC Payment Portal.</p> </li> </ol> <p>You may now use your BillingID to provision a Direct Pay workspace account in BRH.</p>"},{"location":"13-workspace_accounts/#use-billingid-to-provision-direct-pay-funds-for-the-workspace-account","title":"Use BillingID to provision Direct Pay funds for the Workspace Account","text":"<p>Note 1: Before you request a workspace account through any persistent pay model (eg, Direct Pay, STRIDES), be sure to backup all data in your <code>/pd</code> for your workspace. Once your persistent pay model is funded, you will no longer have access to the <code>/pd</code> used during trial access. (What\u2019s a <code>/pd</code>?)</p> <p>Note 2: It can take up to 12 business days to provision funds from a BillingID.</p> <ol> <li>Copy your BillingID from your User Profile page in the OCC Payment Portal.</li> <li>Return to the Workspace Account Manager, and click Request New Workspace to open the Workspace Account Request Form.</li> <li>Click the OCC Direct Pay tab.</li> <li>Paste your BillingID in the field, and enter the first 3 characters of the email address associated with your BillingID (For example, if your email was john.smith@gmail.com, you would enter \u201cjoh\u201d)</li> <li>Click Confirm BillingID. Once your BillingID is confirmed, the bottom part of the form will open to allow you to enter the details for provisioning your account.</li> <li> <p>Be sure to check the box that says that you agree to be invoiced. The amount of the invoice is taken from the value you entered when you made your access request on the Payment Portal.</p> <ul> <li>Enter a title for your project and a brief summary. This is to be used to help you keep track of your requests in case you have multiple accounts for different projects.</li> <li>Identify whether your workspace use is personal or organizational.</li> <li>Indicate whether you have a credit card you are allowed to use to pay for provisioning the workspace account. If your workspace is personal and you have any credit card, the answer will be yes. If your workspace is organizational - make sure you are not using a departmental card or similar without permission.</li> <li>Indicate what role you have as a researcher on this project.</li> </ul> <p></p> </li> <li> <p>Once you submit this form, you will receive an email with the invoice. (It can take up to 5 business days to be sent.) There will be a secure link in the invoice to submit your credit card information and pay the invoice. When you pay the invoice, OCC will apply the funds, create an AWS account for this project\u2019s workspace, and send that information to BRH to provision your account. This can take up to 7 business days after you have signed the form. You will receive an email when your account is set up and ready to be used in your workspace.</p> <p>When you submit this form, you will also see a new entry in the OCC Direct Pay Accounts table in the Workspace Account Manager. The request status for your request will be Pending until the invoice is paid and the account is finalized.</p> </li> <li> <p>Once your Direct Pay request is funded, your workspace will be shown as Active on the Request Status column in the Workspace Account Manager.</p> </li> </ol>"},{"location":"13-workspace_accounts/#strides-grantaward-funded-workspace-account","title":"STRIDES Grant/Award Funded Workspace Account","text":"<p>The STRIDES Grant/Award Funded form can be selected if researchers have received NIH funding (e.g. a grant, contract, cooperative agreement, or other transaction agreement) and intend to use these funds for the BRH workspace account. With this option, the researchers' organization will be responsible for payment.</p> <p></p> <p>Submit the request form. Note that the process of granting access for a workspace account can take 2-4 weeks and users will be notified by email. Following approval, users will see the provisioned workspace account in the BRH Workspace Accounts Manager.</p>"},{"location":"13-workspace_accounts/#strides-credits-funded-workspace-account","title":"STRIDES Credits Funded Workspace Account","text":"<p>Select the STRIDES Credits form to request credits from the NIH STRIDES Initiative for the BRH Workspace account. With this option, once the request is approved, a new account with a set spending limit of will be provisioned by NIH directly for usage.</p> <p></p> <p>Submit the request form. Note that the process of granting access for a workspace account can take 2-4 weeks and users will be notified by email. Following approval, users will see the provisioned workspace account in the BRH Workspace Accounts Manager.</p>"},{"location":"13-workspace_accounts/#what-is-the-nih-strides-initiative","title":"What is the NIH STRIDES Initiative?","text":"<p>The NIH STRIDES initiative (NIH Science and Technology Research Infrastructure for Discovery, Experimentation, and Sustainability) can provide funding for BRH Workspace Accounts. The NIH STRIDES Initiative enables researchers with NIH grants to cost-effectively leverage the use of cloud environments by partnering with commercial providers, such as Amazon Web Services.</p> <p>By leveraging the STRIDES Initiative, NIH and NIH-funded institutions can begin to create a robust, interconnected ecosystem that breaks down silos related to generating, analyzing, and sharing research data.</p> <p>NIH-funded researchers with an active NIH award may take advantage of the STRIDES Initiative for their NIH-funded research projects. Eligible researchers include NIH intramural researchers and awardees of NIH contracts, other transaction agreements, grants, cooperative agreements, and other agreements. More information on NIH STRIDES options and how to gain access can be found here.</p>"},{"location":"14-lauch_with_persistent_paymodel/","title":"Launch a Workspace with a Persistent Pay Model","text":""},{"location":"14-lauch_with_persistent_paymodel/#launch-a-workspace-with-a-persistent-pay-model","title":"Launch a Workspace with a Persistent Pay Model","text":"<p>***Important note: regardless of your account type, remember to terminate your workspace session when you are done using it to avoid accruing additional compute charges (i.e., \"usage\"). You can read more about terminating your workspace on our Getting Started in Workspace page. ***</p> <p>You can select which workspace account pay model to use from the Workspace page.</p> <ul> <li> <p>Log in and click on Workspace to open the workspace page.</p> <p></p> </li> <li> <p>Click on Account Information to expand that tab.</p> <p></p> </li> <li> <p>Under \"Account\" and \"Apply for an account\", you can click the dropdown to select which workspace account you want to use to launch the VM.</p> <p></p> <p>The dropdown will only show workspace accounts that are active.</p> <p>When you only have trial access, launching a new VM will always use your Trial Access workspace account.</p> <p>However, once you have a workspace account funded through a persistent pay model, you will lose the trial access option, and you will only be able to launch a new VM using funded workspace account.</p> <p>Reminder: Each workspace account will have its own <code>/pd</code> for storing data beyond each workspace session. You can download data from one    and upload it to another. But note: once you have a funded workspace account, you will no longer have access to the <code>/pd</code> for your trial access workspace account. Download your data from your trial access account <code>/pd</code> before you receive funding in another workspace account.</p> </li> </ul> <p>Looking for information on how to use the Workspace? Check out our Getting Started page.</p>"},{"location":"15-monitor_compute_usage/","title":"Monitor Compute Usage in Persistent Pay Models","text":""},{"location":"15-monitor_compute_usage/#monitor-compute-usage-with-a-persistent-pay-model","title":"Monitor Compute Usage with a Persistent Pay Model","text":""},{"location":"15-monitor_compute_usage/#where-can-you-see-your-usage","title":"Where can you see your usage?","text":"<p>You can see and monitor your compute usage in two places:</p> <ol> <li>Workspace Page</li> <li>Workspace Account Manager</li> </ol> <p>An important note is that the usage reported in either of these places generally does not immediately update as you use the workspace. AWS reports updated usage about three times per day.</p>"},{"location":"15-monitor_compute_usage/#1-monitor-usage-on-the-workspace-page","title":"1. Monitor usage on the Workspace page","text":"<p>You can see your total usage for any active paid accounts by logging in to the BRH platform, clicking on Workspace, then clicking on Account Information (in the upper left). You can see your total usage and your spending limit.</p> <p>If you have more than one funded workspace account, you can use the dropdown to select different active pay models and view their usage and spending limits.</p> <p></p>"},{"location":"15-monitor_compute_usage/#2-monitor-usage-on-the-workspace-account-manager","title":"2. Monitor usage on the Workspace Account Manager","text":"<p>You can see your usage details on the Workspace Account Manager Accounts page.</p> <p>After logging in, you will be on the Accounts page. There are different tables for each of the three persistent pay models. Find the table for the persistent pay model account you want to monitor, then look for the active account line in that table.</p> <p>The table includes 4 columns relevant for monitoring usage:</p> <ul> <li>Total Usage: This column reports on your compute usage for this account as of the most recent AWS report.</li> <li>Compute Purchased (or STRIDES Credits): This is the total purchase amount you have made for this account. For STRIDES Credits accounts, this is the total amount of credit you were awarded.</li> </ul> <p>The soft and hard limit columns deserve their own section; see below.</p>"},{"location":"15-monitor_compute_usage/#hard-and-soft-limits","title":"Hard and Soft Limits","text":"<p>You can see your hard and soft limits in the tables on the Workspace Account Manager Accounts page. They each have a column:</p> <ul> <li> <p>Soft Limit: This is the limit at which an alert will be triggered for you that you are approaching the spending limit for the account. For STRIDES accounts, users can edit this column to set the alert threshold. For OCC Direct Pay, the soft limit is set in accordance with your Direct Pay User Agreement (signed during Direct Pay BillingID setup).</p> </li> <li> <p>Hard Limit: This is the limit at which a workspace VM will be immediately terminated and the workspace account will be shut down such that no VMs can be launched with it. For STRIDES accounts, users can edit this column to set the threshold at which the account becomes inactive. For OCC Direct Pay, the hard limit is set in accordance with your Direct Pay User Agreement (signed during Direct Pay BillingID setup).</p> </li> </ul> <p></p> <p>What happens when you exceed your funding for a workspace account?</p>"},{"location":"16-usage_exceeds_funding/","title":"If Compute Usage Exceeds Funding","text":""},{"location":"16-usage_exceeds_funding/#if-compute-usage-exceeds-funding","title":"If Compute Usage Exceeds Funding","text":"<p>Coming Soon! We will describe:</p> <ul> <li>Data protections if your workspace is shutdown</li> <li>A terminology guide for shutdown vs terminate</li> </ul>"},{"location":"17-workspace_faq/","title":"Workspace FAQ","text":""},{"location":"17-workspace_faq/#workspace-faqs","title":"Workspace FAQs","text":""},{"location":"17-workspace_faq/#workspace-questions-any-funding-source","title":"Workspace Questions (any funding source)","text":""},{"location":"17-workspace_faq/#what-happens-if-my-trial-access-or-funding-runs-out","title":"What happens if my trial access or funding runs out?","text":"<p>When you have used all of your allotted time (trial access) or funding (persistent pay models), you will no longer be able to launch a workspace. You will not have access to your /pd folder. You will still be able to open the BRH Workspace page, and log in to the Workspace Account Manager. You can request new account funding from the Workspace Account Manager.</p>"},{"location":"17-workspace_faq/#is-the-persistent-directory-pd-shared-among-all-the-pay-model-options-will-my-data-be-available-in-all-my-workspace-accounts","title":"Is the persistent directory (/pd) shared among all the pay model options? Will my data be available in all my workspace accounts?","text":"<p>No. Currently, the /pd folder is separate for each workspace pay model account. So, the data from your /pd for your trial access account will not automatically be available in the /pd for your Direct Pay workspace account or your STRIDES workspace account.</p>"},{"location":"17-workspace_faq/#how-should-i-cite-research-done-in-brh-workspace","title":"How should I cite research done in BRH workspace?","text":"<p>Make sure to cite the author of the data used in your research, the repository housing the data, and the BRH platform enabling your access to the data. See details here.</p>"},{"location":"17-workspace_faq/#direct-pay-workspace-payment-portal-billingid-questions","title":"Direct Pay workspace, Payment Portal, &amp; BillingID questions","text":""},{"location":"17-workspace_faq/#why-does-my-hard-limit-not-match-the-amount-of-funding-i-purchased","title":"Why does my Hard Limit not match the amount of funding I purchased?","text":"<p>As described in your Direct Pay User Agreement, some amount of your purchase is set aside for use for account operational expenses beyond compute costs. If you have further questions about this, please contact billing@occ-data.org</p>"},{"location":"17-workspace_faq/#can-i-get-a-refund-on-any-unused-compute-funding-i-purchased","title":"Can I get a refund on any unused compute funding I purchased?","text":"<p>Unfortunately, as described in your Direct Pay User Agreement, OCC cannot offer refunds for unused compute time already purchased.</p>"},{"location":"17-workspace_faq/#ive-been-using-my-workspace-all-day-but-my-total-usage-number-hasnt-changed-at-all","title":"I've been using my workspace all day, but my total usage number hasn't changed at all.","text":"<p>Data usage is monitored by AWS, and AWS makes updates several times a day. This means that you can possibly use the workspace for a number of hours before the compute usage is updated. Also, the update is sometimes delayed -- that is, a usage update from AWS could still be omitting usage in the hours preceding it.</p>"},{"location":"17-workspace_faq/#what-if-i-dont-pay-the-renewal-invoice-before-my-usage-exceeds-the-hard-limit","title":"What if I don't pay the renewal invoice before my usage exceeds the Hard Limit?","text":"<p>If you do not pay the renewal invoice before you reach the Hard Limit, you will lose access to the Direct Pay account /pd, and you will be unable to launch any workspaces from the Direct Pay account. If you still have not renewed funding 2 months (60 days) after reaching your Hard Limit, we may delete the contents of the /pd for that account.</p>"},{"location":"17-workspace_faq/#why-is-the-occ-payment-portal-a-separate-account","title":"Why is the OCC Payment Portal a separate account?","text":"<p>The OCC payment portal is for our third-party AWS reseller, the Open Commons Consortium (OCC). The site is payments.occ-data.org. This is a separate site and account because we want to protect your financial information; the OCC payment portal site follows more rigorous financial best practices. Please note that neither this site nor OCC as an organization will hold any of your payment information; when you pay an invoice, the actual payment information will go through a separate secure payment processor and is not stored anywhere after the charge is processed.</p>"},{"location":"17-workspace_faq/#can-i-change-my-email-address-associated-with-my-occ-payment-portal-account","title":"Can I change my email address associated with my OCC Payment Portal account?","text":"<p>No. Unfortunately, you cannot change the email address associated with your BillingID or OCC Payment Portal account. You can create a new OCC Payment Portal account with another email address, but you will need to request a new BillingID for that account.</p>"},{"location":"17-workspace_faq/#i-didnt-receive-my-token-for-the-payment-portal-login","title":"I didn\u2019t receive my token for the Payment Portal login.","text":"<p>It may take a couple minutes to send, but not more than that. Check your spam folder. If you don't see it there, you can request another token by clicking the Request Token button again.</p>"},{"location":"17-workspace_faq/#my-token-for-the-occ-payment-portal-expired","title":"My token for the OCC Payment Portal expired","text":"<p>You can request another token by clicking Request Token again.</p>"},{"location":"17-workspace_faq/#how-can-i-find-the-terms-for-the-direct-pay-billing-agreement","title":"How can I find the terms for the Direct Pay billing agreement?","text":"<p>When that document is available, it will be posted on the OCC Direct Pay site. We will link to it when available.</p>"},{"location":"17-workspace_faq/#at-what-point-am-i-actually-paying-for-workspace-funds-what-step-does-the-actual-charge-take-place","title":"At what point am I actually paying for workspace funds - what step does the actual charge take place?","text":"<p>You designate how much you want to purchase when you initially request your BillingID on the OCC Payment Portal. However, the invoice for this amount is not actually sent until after you have done both of the following:</p> <ol> <li>receive a BillingID on the OCC Payment Portal</li> <li>use this BillingID to request a Direct-Pay-funded workspace account in the Workspace Account Manager</li> </ol> <p>Once you have completed both of these, you will be sent an invoice - when you pay this invoice is when you submit your credit card number and actually pay the charged amount.</p>"},{"location":"17-workspace_faq/#what-credit-cards-can-be-used-to-pay-for-direct-pay","title":"What credit cards can be used to pay for Direct Pay?","text":"<p>We accept all major credit cards, including Visa, MasterCard, Discover, and American Express.</p> <p>We also accept ACH electronic payments from a bank account, Apple Pay, PayPal, and Venmo.</p>"},{"location":"17-workspace_faq/#what-are-the-different-websites-involved-in-purchasing-and-using-direct-pay-for-workspaces","title":"What are the different websites involved in purchasing and using Direct Pay for workspaces?","text":"<p>BRH Platform: This is the main BRH site, with all the BRH data and the Workspace page. The site is brh.data-commons.org, and you can reach the Workspace page by clicking on the Workspace button at the top of the portal.</p> <p>BRH Workspace Account Manager: This is where you can request or view details of your Workspace accounts funded with persistent pay models. The site is brh-portal.org, and you can also reach this site from the BRH Workspace page by clicking on the <code>Workspace Account Manager</code> link at the top left corner, in the Account Information section. This page will be built into the BRH Platform Workspace page in a future update (i.e., it won't be a separate page).</p> <p>OCC Payment Portal: This is the payment portal site for our third-party AWS reseller, the Open Commons Consortium (OCC). Here, you can request a BillingID, specify the amount of Direct Pay funding you will want on your Direct Pay account, and track the status of your BillingID request. The site is payments.occ-data.org. Note: Neither this site nor OCC will hold any of your payment information; when you pay an invoice, the actual payment information will go through a separate secure payment processor and is not stored anywhere after the charge is processed.</p>"},{"location":"17-workspace_faq/#strides-questions","title":"STRIDES Questions","text":""},{"location":"17-workspace_faq/#what-is-the-strides-program","title":"What is the STRIDES Program?","text":"<p>The NIH STRIDES Initiative is a program to help NIH-funded researchers accelerate biomedical research by reducing barriers to utilizing for-fee cloud services, like the BRH Workspace.</p> <p>The STRIDES program gives cost discounts and a host of other benefits to researchers with NIH grants and contracts.</p>"},{"location":"17-workspace_faq/#what-are-the-benefits-for-using-the-strides-program","title":"What are the benefits for using the STRIDES program?","text":"<p>STRIDES program benefits include:</p> <ul> <li>Cost discounts on AWS services (e.g., compute, storage, and egress fees)</li> <li>AWS Enterprise Support</li> <li>Training and education programs</li> <li>and more! See the STRIDES program benefits page for more information</li> </ul>"},{"location":"17-workspace_faq/#who-is-eligible-for-using-the-strides-program","title":"Who is eligible for using the STRIDES program?","text":"<p>Anyone with any NIH funding, for any NIH award type, is eligible for the benefits of the STRIDES Initiative.</p>"},{"location":"17-workspace_faq/#what-is-the-difference-between-strides-credit-and-strides-grantaward-funded","title":"What is the difference between STRIDES Credit and STRIDES Grant/Award Funded?","text":"<p>The main difference is who is responsible for paying to provision the Workspace account.</p> <p>STRIDES Grant/Award Funded: This is the most common STRIDES account model. Here, the Workspace account is provisioned by organization receiving the NIH grant funds (generally a PI's institution). Researchers who have received NIH funding (e.g. a grant, contract, cooperative agreement, or other transaction agreement) can use these funds for the BRH workspace account. With this option, the researchers' organization will be responsible for payment.</p> <p>STRIDES Credits This is less common. Here, the payment for provisioning the Workspace account is made directly by NIH. Generally this is discussed with NIH ahead of submitting the request. With this option, once the request is approved, a new account with a set spending limit of will be provisioned by NIH directly for usage.</p>"},{"location":"nextflow-create-docker/","title":"Nextflow - Create Dockerfile","text":""},{"location":"nextflow-create-docker/#create-a-dockerfile","title":"Create a Dockerfile","text":""},{"location":"nextflow-create-docker/#overview","title":"Overview","text":"<p>This guide is for users who want to build Docker containers for use in Gen3 workspaces.</p>"},{"location":"nextflow-create-docker/#prerequisites","title":"Prerequisites","text":"<ul> <li>Docker Desktop installed on your local machine (note: Docker Desktop comes with Docker Scout, which will allow you to do your own preliminary security scanning before requesting credentials, so as to save you time. Strictly speaking, only the Docker CLI is required if you are willing to risk uploading without scanning.)</li> <li>Docker Scout (comes with Docker Desktop) - required for scanning your built image before requesting credentials</li> <li>Create a Docker account - also required for scanning your built image before requesting credentials (when you sign in on Docker Desktop for the first time, you will be asked to create an account)</li> <li>Clone or download the <code>bio-nextflow</code> repo</li> </ul>"},{"location":"nextflow-create-docker/#start-with-a-security-validated-base-image","title":"Start with a security-validated base image","text":"<p>Gen3 offers a collection of FedRAMP security-compliant base images. We re-assess these base images regularly for security compliance. Building on these base images makes it easier for your customized Docker image to pass the security scanning.</p> <p>You can access the URLs to pull these images using Docker here:</p> <p>https://github.com/uc-cdis/containers/blob/master/nextflow-base-images/allowed_base_images.txt</p> <p></p> <p>Please note: if, when you click on this link to the base image text file, you see an asterisk next to one of these URLs, it means that the image is temporarily unavailable because it is being updated. Please wait until the asterisk is removed to build an image on that base image. If you would like an estimated timeframe for when the base image will be available, please ping us on Slack (<code>nextflow-support</code>).  </p>"},{"location":"nextflow-create-docker/#how-to-choose-your-base-image","title":"How to choose your base image","text":"<p>GPU vs. CPU</p> <p>Not sure what these are? Here's a nice overview.</p> <p>In our BRH Workspace, we offer workspace images for CPU and GPU tools. You can read more about this on our Getting Started page. Choose the appropriate workspace image (CPU or GPU) for your Docker image and tools.</p> <p>GPU images</p> <p>Note for May 2024 MIDRC testers: please be sure to choose the image using CUDA 11.8; even though it is described as \"less preferred\", it is the version that is compatible with the other tools you're using.</p> <p>We have 3 base images in our current selection that offer CUDA support for running on GPUs -- these have \"cuda\" in the image name, followed by the CUDA version. When possible, please choose the latest version of CUDA compatible with your tools.</p> <p>gen3-cuda-12.3-ubuntu22.04-openssl (preferred)</p> <p>gen3-cuda-12.3-torch2.2-ubuntu22.04-openssl (also preferred)</p> <p>gen3-cuda-11.8-ubuntu22.04-openssl (only use if your tools require a lower version of CUDA)</p> <p>CPU images</p> <p>We have one base image that is available for running workflows on CPUs.</p> <p>amazonlinux-base</p>"},{"location":"nextflow-create-docker/#verify-that-your-docker-and-docker-scout-are-working-as-expected","title":"Verify that your Docker and Docker Scout are working as expected","text":"<p>Before you take the time to build your own Dockerfile, it's good to be sure your Docker is able to pull the base image of interest and that you are able to scan with Docker Scout. Doing these tests will be quite quick, and will help you identify problems more easily than if you try to troubleshoot problems in a build. This is also a good opportunity to verify that your selected base image has not accumulated any vulnerabilities since we last scanned it.</p>"},{"location":"nextflow-create-docker/#test-pulling-the-docker-image","title":"Test pulling the Docker image","text":"<p>This will help make sure you can pull the base image of interest by running the <code>docker pull</code> commmand in your terminal, as described below.</p> <p>First, open your Docker Desktop application (just to be sure Docker is running).</p> <p>Next, open your terminal. Run <code>docker pull &lt;image URL&gt;</code>, where the image URL is the full line as displayed in the file of security-validated base images. If it's working, you will see language that it is pulling (see below). When it's complete (and successfully pulled), there will be a line that says <code>Status: Downloaded &lt;image&gt;</code> (see yellow highlight below). If you see this, you know that all the steps necessary to pull your image work. If you don't see this, reach out to us on Slack (<code>nextflow-support</code>, do not use <code>@</code>)</p> <p></p>"},{"location":"nextflow-create-docker/#test-using-docker-scout-to-evaluate-image-vulnerabilities","title":"Test using Docker Scout to evaluate image vulnerabilities","text":"<p>At the end of your test pull, Docker offers a suggestion to use Docker Scout to examine your image for vulnerabilities (see red box above). Since you will want to use Docker Scout to evaluate your custom build later, now is a convenient time to test this tool and make sure you are fully set up to run Docker Scout. Although we do not expect the base images to have any security problems, it's most efficient to run this quick check before you spend time building on this image, in case it has accumulated a vulnerability since we last scanned it.  </p> <p>Note: If you don't seem to have access to Docker Scout, check whether you're using the latest Docker version.</p>"},{"location":"nextflow-create-docker/#run-docker-scout","title":"Run Docker Scout","text":"<p>To run Docker Scout, you must:</p> <ul> <li>have Docker running (for example, the desktop application open)</li> <li>be signed in to Docker (in the desktop application, there is a Sign In button in the upper right corner)</li> <li>have created a Docker account (when you sign in for the first time, you will be asked to create an account).</li> </ul> <p>Once you are signed in to Docker, you can run the command they suggest after pulling an image (for example, see the command in blue text in the red box above, <code>docker scout quickview &lt;image URL&gt;</code>). If the command runs successfully, you should see output similar to the screenshot below. This is a summary of the vulnerabilities in your image.</p> <p></p> <p>You can run the next suggested command (shown in red box above, <code>docker scout cves...</code>) to see the full list of vulnerabilities.</p> <p>Images should be able to pass Gen3 security scanning if there are no Critical vulnerabilities. </p> <p>But please note: The unfortunate nature of vulnerabilities is that there are always new ones appearing, despite our active monitoring. If you do see that one of our base images has a Critical vulnerability reported by Docker Scout, please alert us on Slack (<code>nextflow-support</code>)</p> <p>Want to know more about Docker Scout? Check out the documentation.</p>"},{"location":"nextflow-create-docker/#build-your-image-locally-on-top-of-the-base-image","title":"Build your image locally on top of the base image","text":"<p>To build your own image, you need to create a Dockerfile. (Reminder: Dockerfiles are typically named just \"Dockerfile\" - with a capital D and no file extension.) To build your image on a base image, the first line of the Dockerfile should reference the base image tag. The Dockerfile you create typically lives in the Git repository where you have your code to make it easier to copy into your container.  </p> <p>Important note: Users on Macs with an M1 or M2 chip MUST build the Docker image using a platform flag so it can be run in Batch. (If you are not using an M1/M2 chip, you can also use this command, although you do not have to if you prefer a more typical build command.) This command will set the appropriate target platform for <code>build</code> so your image can be used in Batch:  </p> <p><code>docker buildx build --pull --platform linux/amd64 .</code></p> <p>(note the <code>.</code> at the end of the command)</p> <p>The <code>--pull</code> part of the command will ensure you are always pulling a fresh version of the base image, and not using any cached images from previous builds that may now have vulnerabilities.</p> <p>You can read more about this platform flag and building for a platform here and here.</p>"},{"location":"nextflow-create-docker/#unfamiliar-with-creating-dockerfiles","title":"Unfamiliar with creating Dockerfiles?","text":"<p>If you are unfamiliar with creating Dockerfiles, we encourage you to explore the excellent tutorial here, as well as review the Dockerfile documentation here, before you proceed.  </p> <p>Note: Dockerfiles are typically named just \"Dockerfile\" - with a capital D and no file extension.</p>"},{"location":"nextflow-create-docker/#example-build-an-image-with-a-dockerfile-and-a-requirementstxt","title":"Example: Build an image with a Dockerfile and a requirements.txt","text":"<p>Please note: Images built on any of the base images with CUDA can take 3 hours or more to completely build. </p> <p>In our example here, we will have you build your image using a <code>requirements.txt</code> to identify the software tools you want to add to the base image, as well as a Dockerfile that pulls in the base image, adds the software tools specified in the requirements file, copies relevant code files, and establishes some setup parameters.</p> <p>Our example will use the files in the torch_cuda_test directory of the bio-nextflow repository. You can review the <code>readme</code> file in this directory for more information. It is a simple example that will build up from our base image by adding PyTorch. The Nextflow script will ultimately use a Python script that checks the version of CUDA in the GPU instance and checks whether it is compatible with the version of PyTorch and CUDA available in the container.</p> <p>First, in the terminal, navigate to the directory where you cloned the the <code>bio-nextflow</code> repository (see Prerequisites section). Next, navigate to where the downloaded Dockerfile and requirements.txt are located:</p> <p><code>cd bio-nextflow/nextflow_notebooks/containerized_gpu_workflows/torch_cuda_test</code></p> <p>If you open the Dockerfile, note that the first line of the Dockerfile references the URL for one of our GPU base images. This is always how you will reference a base image -- with <code>FROM</code> and the URL.</p> <p>Then, run the Docker <code>build</code> command. For example:</p> <p><code>docker buildx build --pull --platform linux/amd64 . -t my_docker</code> </p> <p>will tag the Dockerfile in the local directory with the tag <code>my_docker</code>, and build a Docker image using the Dockerfile.  </p>"},{"location":"nextflow-create-docker/#example-examine-built-image-for-vulnerabilities","title":"Example: Examine built image for vulnerabilities","text":"<p>You now have a new Docker image built upon our security-compliant base image. To identify and address any security concerns in your customized image before submitting for upload, we encourage all users to locally scan their image for vulnerabilities using Docker Scout, as described in our test above. Here, we have tagged our new image with <code>my_docker</code>. So, we would run the Docker Scout <code>quickview</code> command on the image using this command:</p> <p><code>docker scout quickview my_docker</code></p> <p>And to identify the specific vulnerabilities and recommendations, you would run:</p> <p><code>docker scout cves my_docker</code></p>"},{"location":"nextflow-create-docker/#my-image-passes-the-local-security-scanning","title":"My image passes the local security scanning","text":"<p>Once your custom image is security-compliant based on the analysis from Docker Scout, you are ready to request credentials to submit your Docker image for Gen3 security scanning.  </p> <p>Local security scanning of your built images is highly recommended for the most efficient path to having your image available for use in Nextflow workflows. However, it is not absolutely required; you can submit images without first scanning them with Docker Scout. If you do not do local scanning, there is a higher chance that you will have to submit your custom-built images more than once.  </p> <p>Continue to Request Credentials</p>"},{"location":"nextflow-getting-started/","title":"Nextflow - Getting Started","text":""},{"location":"nextflow-getting-started/#getting-started-with-workflows-on-gen3","title":"Getting started with workflows on Gen3","text":"<p>Please note: Nextflow features are only available to users with a Direct Pay workspace account. See our documentation for persistent paymodels to learn more about getting a Direct Pay workspace account.</p>"},{"location":"nextflow-getting-started/#background","title":"Background","text":""},{"location":"nextflow-getting-started/#what-is-gen3","title":"What is Gen3?","text":"<p>The Gen3 platform consists of open-source software services that make up data commons and data ecosystems (also called meshes or fabrics). A data commons is a platform that co-locates both data and compute resources so researchers can bring algorithms to the data. Data ecosystems or meshes are systems that researchers can use to search and query across multiple data commons in one location.</p> <p>More information about Gen3 can be found here. A list of data platforms using the Gen3 technology can be found here.</p>"},{"location":"nextflow-getting-started/#what-are-workflows","title":"What are workflows?","text":"<p>A workflow is a computational pipeline that consists of a series of steps to be executed. It could run using a software container that is a standalone, self-contained piece of software containing all the executables needed for the workflow.</p> <p>Many workflow languages have been developed in recent years. Common examples include Common Workflow Language (CWL), Open Workflow Description Language (WDL), and Nextflow. We will be using Nextflow for our exercises.</p>"},{"location":"nextflow-getting-started/#workflow-execution-in-gen3","title":"Workflow execution in Gen3","text":"<p>Gen3 is based on kubernetes and is container-based. A container is a standalone, self-contained collection of software that contains specific software you may need for your application (e.g., Pydicom/DICOM, Numpy, SciPy). We are testing a new workflow execution system in Gen3 that researchers can use to run containers on the cloud for various applications in a secure and isolated manner. We developed an isolation process so that each user\u2019s workflow is separate from each other, from the Gen3 core system, and from Gen3 data, except when approved and required for the specific task. The testing and development of workflows is currently underway in the Biomedical Research Hub (BRH), one of the first data ecosystems (or meshes) built at CTDS.</p>"},{"location":"nextflow-getting-started/#what-is-nextflow-what-is-aws-batch","title":"What is Nextflow? What is AWS Batch?","text":"<p>The workflow execution in Gen3 is powered using Nextflow, a framework for writing data-driven computational pipelines using software containers. It is a very popular and convenient framework for specifying containers, inputs and outputs, and running jobs on the cloud. Researchers have used Nextflow for several years, and 2023 has continued to see a rapid gain in its popularity per a recent survey. The scalability of workflows in Gen3 comes from AWS Batch, an AWS service capable of running compute jobs over large datasets on the Cloud.</p>"},{"location":"nextflow-getting-started/#steps-to-run-workflows-in-gen3","title":"Steps to run workflows in Gen3","text":"<p>To run workflows in Gen3, you will need the following:</p> <ul> <li>Access to the BRH workspace (covered on this page)</li> <li>A funded workspace account (covered on this page)</li> <li>A Docker image uploaded to an ECR created for you (start with Create Dockerfile)</li> </ul> <p>Depending on your specific workflows, you may also need additional tools, resources, or access.</p>"},{"location":"nextflow-getting-started/#get-access-to-the-brh-workspace-and-set-up-a-funded-account","title":"Get access to the BRH workspace and set up a funded account","text":""},{"location":"nextflow-getting-started/#1-request-access-to-the-brh-workspace","title":"1) Request access to the BRH workspace","text":"<p>The BRH exposes a computational workspace that researchers can use to run simple Jupyter notebooks and submit workflows. To submit workflow jobs, you need access to the BRH workspace.</p> <p>Follow these instructions to request trial access to the BRH workspace.  After you have submitted your request, please ping <code>nextflow-support</code> in Slack (do not use @ or it will not work)to alert us to look for your request and approve it. We will notify you by Slack when you are approved.  </p>"},{"location":"nextflow-getting-started/#2-establish-a-workspace-account-with-a-persistent-pay-model-in-brh","title":"2) Establish a workspace account with a persistent pay model in BRH","text":"<p>When you initially are granted workspace access in BRH, it is a trial access that is free for the user (paid by CTDS). However, the trial access paymodel does not permit access to the Nextflow image. To gain access to the Nextflow image needed for testing, you must request a workspace account with a persistent paymodel, so that the cost of compute jobs in your project can accrue to the right account. BRH currently supports several persistent pay models such as NIH STRIDES (payment through grant funds) and Direct Pay (credit card payment). If you're curious, see here for more information about pay models.</p> <p>For selected MIDRC user accounts who have been separately notified, we have already established a Direct-Pay-type* of workspace account for testing. When you receive workspace access, the Nextflow Support team will also add a Direct Pay account to your workspace.</p> <p>* Note about this Direct-Pay-type of account: It is not an ACTUAL Direct Pay account, and it does not go through the normal Direct Pay account route, nor through OCC, at all. It is funded with MIDRC contract funds, but will be labeled Direct Pay in your workspace.</p>"},{"location":"nextflow-getting-started/#3-launch-a-workspace-with-the-persistent-paymodel","title":"3) Launch a workspace with the persistent paymodel","text":"<p>Once you have been notified that you have a workspace account provisioned with persistent paymodel funds, you can proceed.</p> <ul> <li>Log in to BRH and open the workspace page.</li> <li>In the dropdown under \"Account\" in top left, select \"Direct Pay\" as your paymodel (#1 in screenshot below).</li> <li>Once you select the Direct Pay workspace account, you should see a new option for workspace image: \"(Beta) Nextflow with CPU instances\"</li> <li>Click the Launch button for this Nextflow workspace image (#2).</li> <li>When you click the button, the workspace will begin to launch. This can take 5-10 minutes. You will know you successfully started the launch because you will see 3 animated dots rippling in the Launch button (see yellow highlight). <p>If it takes longer than 10 minutes, try refreshing the screen and re-trying the launch. If it seems to stall out (longer than 10 min again), or if you get an error, reach out to CTDS staff through the Slack channel (but don't close the tab with the launch).</p> </li> </ul> <p></p>"},{"location":"nextflow-getting-started/#quick-orientation-to-the-the-workspace","title":"Quick orientation to the the workspace","text":"<p>Before using the workspace, we strongly encourage you to review the BRH Workspace documentation.</p> <p>There are several key points we want you to be aware of:</p>"},{"location":"nextflow-getting-started/#store-all-data-in-the-persistent-directory-pd","title":"Store all data in the persistent directory (/pd)","text":"<p>Store all files you want to keep after the workspace closes in the <code>/pd</code> directory; only files saved in the /pd directory will persist. Any personal files in the folder <code>data</code> will be lost.</p> <p></p>"},{"location":"nextflow-getting-started/#automated-shutdown-for-idle-workspaces","title":"Automated shutdown for idle workspaces","text":"<p>Workspaces will automatically be shut down (and all workflows terminated) after 90 minutes of idle time.</p>"},{"location":"nextflow-getting-started/#gpu-vs-cpu-nextflow-workspace-images","title":"GPU vs CPU Nextflow workspace images","text":"<p>As you can see in the screenshot above, there are 2 Nextflow workspace images: A CPU image and a GPU image. If your workflow requires GPU (e.g., deep learning or other AI/ML models), please use the GPU instance; otherwise, use CPU. You can read more about CPU and GPU options in Gen3 Nextflow here.  </p> <p>Continue to Overview of Containers in Gen3</p>"},{"location":"nextflow-overview-containers/","title":"Nextflow - Containers in Gen3","text":""},{"location":"nextflow-overview-containers/#overview-developing-and-deploying-containers-in-gen3","title":"Overview: Developing and Deploying Containers in Gen3","text":"<p>Locally build and test container:</p> <p>Gen3 provides several FedRAMP security-compliant base images that users can pull and customize.</p> <p>Request credentials and push container to Gen3 staging:</p> <p>Users can email Gen3 to request short-term credentials that permit them to authenticate Docker in their terminal to upload the local Docker image to a Gen3 staging repo for security review.</p> <p>Container is security-scanned; Gen3 sends approved container URI:</p> <p>Gen3 completes the security scan of the container. Typically, the scanning completes within a couple hours; however it takes longer for larger images with more layers. If it is security-compliant, the image is moved to an ECR repo (\"approved\") from where the container can be run, and Gen3 staff will send a container URI to the user for use in the Nextflow workflows.</p> <p>If there are problems that make the image non-compliant with security requirements, a report of the vulnerabilities is provided to the user for remediation and resubmission. Users are responsible for resolving image vulnerabilities and resubmitting for scanning.  </p> <p>Run workflow using approved container URI:</p> <p>In the BRH workspace, use a Nextflow Jupyter notebook to run Nextflow workflows in the approved container using the approved container URI. Some example notebooks can be found here, and specific examples that use an approved image URI can be found here and here</p> <p>Continue to Create Dockerfile</p>"},{"location":"nextflow-request-creds/","title":"Nextflow - Request Credentials","text":""},{"location":"nextflow-request-creds/#request-credentials-for-uploading-a-docker-container","title":"Request Credentials for Uploading a Docker Container","text":"<p>Before you request credentials, please be sure that you have successfully built your Docker image locally, and that you have already scanned it with Docker Scout. This will reduce the likelihood of needing to re-request credentials for this container.</p> <p>Please copy and paste the email template below into a new email and send to brhsupport@gen3.org. Please be sure to add the relevant information to the bolded fields.</p> <p>Hello, User Services,</p> <p>Please create new temporary AWS credentials to permit me to upload a Nextflow container.</p> <p>The email address or ORCID I use to log in to BRH is: [BRH login email here]</p> <p>I understand that these credentials will last for 1 hour, once created. If I continue to need access to upload after they expire, I will request new credentials.</p> <p>Since the credentials will ONLY last 1 hour after creation, you may prefer we send them at a certain time of day. Please delete which of these do NOT apply:</p> <ul> <li>Please generate and send my credentials tomorrow morning</li> <li>Please generate and send my credentials in the afternoon</li> <li>Please generate and send my credentials ASAP</li> </ul> <p>To ensure prompt attention, I will also ping <code>nextflow-support</code> (please do not use @ for this) on the Slack channel after I have sent my email.</p> <p>Thanks!</p> <p>[your name]</p> <p>We will send you the credentials through direct message on Slack, in a link to keep them private.  </p> <p>Please note: If you receive credentials but you are not able to successfully upload an image before they expire, please ping <code>nextflow-support</code> on Slack to let us know we do not need to monitor your submitted image.</p> <p>Continue to Upload Docker Image</p>"},{"location":"nextflow-tutorial-workflows/","title":"Nextflow - Tutorials Workflows","text":""},{"location":"nextflow-tutorial-workflows/#tutorial-nextflow-workflows","title":"Tutorial Nextflow Workflows","text":"<p>We have a collection of notebooks using Nextflow in Gen3 here: https://github.com/uc-cdis/bio-nextflow/tree/master/nextflow_notebooks</p> <p>Before you start executing any tutorial notebooks, review the information in the Get Set section.  </p>"},{"location":"nextflow-tutorial-workflows/#get-set-download-necessary-credentials-and-software","title":"Get set: Download necessary credentials and software","text":"<p>Be ready to execute the tutorial workflows below by gathering credentials and installing necessary software.  </p>"},{"location":"nextflow-tutorial-workflows/#get-and-replace-placeholder-values-from-the-nextflow-config","title":"Get and replace placeholder values from the Nextflow config","text":"<p>You can find the values to replace the placeholders in the<code>queue</code>, <code>jobRole</code> and <code>workDir</code> fields in the <code>nextflow.config</code> file in your Nextflow workspace (this is found in <code>/data directory</code>, unless you have moved it to the <code>/pd</code>). These placeholder values will need to be replaced in each of the various tutorial Nextflow notebooks.</p> <p>Note that you should only copy/paste the value to replace <code>placeholder</code> for each field; do not copy/paste larger sections of the nextflow config, or there could be indentation problems that interfere with the code.</p>"},{"location":"nextflow-tutorial-workflows/#midrc-credentials","title":"MIDRC credentials","text":"<p>To download GUIDs in the workspace, you will first need to generate a MIDRC credentials on the profile page of the MIDRC portal. For this, please go to data.midrc.org, click on the user icon in the right corner (#1), and open the Profile page (#2). Click on Create API Key (#3). A pop-up window will appear with the key. If you scroll down slightly, you can see the button to download the credentials as a JSON. Credentials are valid for 1 month.</p> <p></p>"},{"location":"nextflow-tutorial-workflows/#example-nextflow-notebooks","title":"Example Nextflow notebooks","text":""},{"location":"nextflow-tutorial-workflows/#notebooks-with-no-containers","title":"Notebooks with no containers","text":"<p>There are several general Nextflow notebooks that do not use containers at all. If you're new to nextflow and just want to get started with workflow commands, try these notebooks: https://github.com/uc-cdis/bio-nextflow/tree/master/nextflow_notebooks/non_containerized_nextflow_workflows</p>"},{"location":"nextflow-tutorial-workflows/#notebooks-using-containers","title":"Notebooks using containers","text":"<p>We have several containerized notebooks using CPU, and other containerized notebooks using GPU.  </p>"},{"location":"nextflow-tutorial-workflows/#notebooks-using-cpu","title":"Notebooks using CPU","text":"<p>You can find the directory with containerized notebooks using CPU here: https://github.com/uc-cdis/bio-nextflow/tree/master/nextflow_notebooks/containerized_cpu_workflows</p> <p>Some use cases in this directory include:</p> <ul> <li>Cancer use case: The <code>chip_cancer</code> example tutorial here includes a Dockerfile, a requirements file, a Nextflow notebook, a collection of python scripts, and a README.</li> <li>DICOM metadata extraction use case: The <code>midrc_batch_demo</code> example tutorial here includes a Dockerfile, a requirements file, two Nextflow notebooks, a collection of python scripts, and a README.</li> </ul>"},{"location":"nextflow-tutorial-workflows/#notebooks-using-gpu","title":"Notebooks using GPU","text":"<p>You can find the directory with containerized notebooks using GPU here: https://github.com/uc-cdis/bio-nextflow/tree/master/nextflow_notebooks/containerized_gpu_workflows</p> <p>Some use cases in this directory include:</p> <ul> <li>Pytorch/cuda test simple use case: The <code>torch_cuda_test</code> example tutorial here includes a Dockerfile, a requirements file, a Nextflow notebook, a simple python script, and a README.</li> <li>COVID Challenge 2022 use case: The <code>covid_challenge_container</code> example tutorial here includes a Dockerfile, a requirements file, a Nextflow notebook, a python script, and a README.</li> </ul>"},{"location":"nextflow-upload-docker/","title":"Nextflow - Upload Docker Image","text":""},{"location":"nextflow-upload-docker/#pushing-docker-images-to-aws-ecr","title":"Pushing Docker Images to AWS ECR","text":""},{"location":"nextflow-upload-docker/#overview","title":"Overview","text":"<p>This guide is for users who have received temporary credentials granting access to push container images to a specific AWS Elastic Container Registry (ECR) repository.</p>"},{"location":"nextflow-upload-docker/#prerequisites","title":"Prerequisites","text":"<ul> <li>Docker installed on your local machine. This can be Docker Desktop or the Docker CLI. </li> <li>AWS CLI installed locally</li> <li>Temporary AWS credentials provided by the User Services team (see Request Credentials).</li> <li>The ECR repository URI you have been given access to (at the top of the AWS credentials provided by the support team)</li> <li>A built image you want to push (see Create a Dockerfile)</li> </ul>"},{"location":"nextflow-upload-docker/#a-note-about-timing","title":"A note about timing","text":"<p>Your temporary AWS credentials only lasts for 1 hour from when they were created; User Services should have provided an expiration time when sharing the credentials with you. You must start the push to ECR before they expire, or you will need to request new credentials from User Services.</p> <p>If you do not push an image to the ECR before they expire, please ping <code>nextflow-support</code> in Slack so we know not to monitor for an image to progress through scanning.</p>"},{"location":"nextflow-upload-docker/#a-note-about-security-and-expiration-of-approved-docker-images","title":"A note about security and expiration of approved Docker images","text":"<p>Because of the ever-updating nature of vulnerability detection, an image that has passed in the past is not guaranteed to always pass. Even if you are resubmitting an image that has passed previously, there may be new vulnerabilities that have been reported that mean the image does not pass now. Best practices for most efficient submission are to always examine an image with Docker Scout before pushing it.  </p> <p>Similarly, because new vulnerabilities are always emerging, to protect the security of the Gen3 Workspace, approved containers will only remain available in the approved repo for 30 days. However, users can always request new credentials and resubmit their image for scanning.</p> <p>Finally, although we make every effort to regularly scan and monitor our base images to ensure that they are free of all critical vulnerabilities, you may have the misfortune to be the first to find a vulnerability in our base image. If you believe you have identified a critical vulnerability in one of our base images, please ping us on Slack at <code>nextflow-support</code>.  </p>"},{"location":"nextflow-upload-docker/#set-aws-environment-variables","title":"Set AWS environment variables:","text":"<p>The commands in this section are valid if you are using a Linux or MacOS. If you are using Windows, we will provide a separate set of commands for you to set the AWS environment variables.</p> <p>Before you can push your Docker image to the ECR repository, you need to configure the AWS CLI with the temporary credentials you received. In the credentials sent to you, there should be the commands needed to run this below the line \"Please run the following commands to set your AWS credentials:\". Copy those (they will look similar to the block below) and run them in the terminal.</p> <pre><code>  export AWS_ACCESS_KEY_ID=&lt;AccessKeyId&gt;\n  export AWS_SECRET_ACCESS_KEY=&lt;SecretAccessKey&gt;\n  export AWS_SESSION_TOKEN=&lt;SessionToken&gt;\n</code></pre> <p>Note: for Linux or Windows, the variables are set only as long as the terminal is open; export the variables again if you close and open a new terminal.</p>"},{"location":"nextflow-upload-docker/#verify-configuration","title":"Verify configuration:","text":"<p>Run <code>aws sts get-caller-identity</code> to verify that your CLI is using the temporary credentials. If you successfully set the variables, you should see output showing the AWS information - UserID, account, etc.</p>"},{"location":"nextflow-upload-docker/#authenticate-docker-to-ecr","title":"Authenticate Docker to ECR","text":"<p>Next, use the AWS CLI to retrieve an authentication token and authenticate your Docker client to your registry. In the credentials, there is a command below the line \"After setting credentials you will need to log in to your docker registry. Please run the following command:\". Copy that (it will look similar to the command below) and run it in the terminal.</p> <pre><code> aws ecr get-login-password --region &lt;region&gt; | docker login --username AWS --password-stdin &lt;repositoryUri&gt;\n</code></pre>"},{"location":"nextflow-upload-docker/#preparing-to-push-your-docker-image-tag-your-docker-image","title":"Preparing to push your Docker image: Tag your Docker image","text":"<p>You should already have a locally-built Docker image before you get your credentials. But, you do need to tag it with the ECR repository URI and the image tag you want to use.  </p> <pre><code> docker tag &lt;local-image&gt;:&lt;local-tag&gt; &lt;repositoryUri&gt;:&lt;image-tag&gt;\n</code></pre> <p>Replace <code>&lt; local-image &gt;</code> with the name of your local Docker image and <code>&lt; local-tag &gt;</code> with the tag you want to push.</p> <p>If you're not sure what your local image and tag names are, you can run <code>docker images</code> in your terminal. It will provide a list of all your saved docker images. The column called <code>REPOSITORY</code> is the local image name. The column called <code>TAG</code> is the local tag name for this image. Note: the <code>image-tag</code> you select will travel with your image to the approved repo. So, select a tag you are comfortable with.</p> <p>Replace <code>&lt; repositoryUri &gt;</code> with the ECR repository URI provided at the top of the credentials file, and <code>&lt; image-tag &gt;</code> with the image tag name you want to use in your ECR.</p> <p>Important note: If you do not want the most-recently-pushed image to replace an earlier version with the same tag in your ECR, image-tags should be unique. For example, you create an image with an image-tag <code>batch-poc</code>. If you later push another image to <code>&lt; repositoryUri &gt;:batch-poc</code>, it will overwrite the previous version of the image in your ECR (you will only have 1 container with the image tag \"batch-poc\"). If you do not want to overwrite, you can use versioned image-tags. For example: <code>batch-poc-1.0</code>, and then <code>batch-poc-1.1</code>. If you want to replace previous versions of your container, you can use the same image-tag.  </p>"},{"location":"nextflow-upload-docker/#push-the-docker-image-to-the-ecr","title":"Push the Docker image to the ECR","text":"<p>Push the tagged image to the ECR repository. The <code>docker push</code> command is also in the credentials - you just need to specify the image tag you selected when either tagging or building the image in the previous section.  </p> <pre><code> docker push &lt;repositoryUri&gt;:&lt;image-tag&gt;\n</code></pre> <p>If the push is successful, you will see various \"layer 1\" \"layer 2\" etc outputs, and it will indicate progress in pushing. This can take minutes or longer, depending on how large your container is.  </p> <p>If the push fails, you will get a persistent message about \"Waiting for layer\". This usually means it cannot find the repository, so double-check that there is no typo, and that you have set your AWS environment variables since you opened the terminal most recently.  </p>"},{"location":"nextflow-upload-docker/#completion","title":"Completion","text":"<p>Once the push completes, your Docker image will be available in the ECR repository (although you will not be able to see it). It will be scanned, and if passes the security scanning, CTDS will move it to the nextflow-approved repo. When it's available in nextflow-approved, User Services will reach out by direct message in Slack to share a Docker image URI that looks something like this: <code>&lt; account number &gt;.dkr.ecr.us-east-1.amazonaws.com/nextflow-approved/&lt; your username &gt;:&lt; image-tag &gt;</code> You can then use this image URI (not to be confused with your repository URI) to run Nextflow workflows with your container in the BRH workspace. (Note that you need to copy the whole image URI into the container field of the nextflow notebook, as described in the next section.)</p>"},{"location":"nextflow-upload-docker/#how-to-use-an-approved-docker-image-uri","title":"How to use an approved Docker Image URI","text":"<p>Once you have your Docker image URI, you are ready to run your Nextflow workflow! You can take the Docker image URI (copy the entire line) and make it the value for the \"container\" field(s) in your Nextflow notebook. For example, in the <code>torch_cuda_batch</code> Nextflow notebook, you would go to the <code>nextflow.config</code> section and replace the <code>placeholder</code> value for <code>container</code> with the approved Docker image URI sent by the support team after you pushed the image for scanning.  </p> <p>Please note that you will need to replace all <code>placeholder</code> values in the <code>nextflow.config</code> with values specific to your workspace. Please see the section \"Get and replace placeholder values from the Nextflow config\" on the Tutorials page for more information.</p> <p></p>"},{"location":"nextflow-upload-docker/#support","title":"Support","text":"<p>If you encounter any issues or require assistance, please reach out to the User Services team on Slack at <code>nextflow-support</code> (no <code>@</code>), or by email at brhsupport@gen3.org. (Slack will result in the quickest reply.)</p> <p>Continue to Tutorial Workflows</p>"}]}