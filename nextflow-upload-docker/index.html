
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://brh.data-commons.org/nextflow-upload-docker/">
      
      
        <link rel="prev" href="../nextflow-request-creds/">
      
      
        <link rel="next" href="../nextflow-tutorial-workflows/">
      
      
      <link rel="icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.6">
    
    
      
        <title>Nextflow - Upload Docker Image - Biomedical Research Hub Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.35e1ed30.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="brh_platform" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pushing-docker-images-to-aws-ecr" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Biomedical Research Hub Documentation" class="md-header__button md-logo" aria-label="Biomedical Research Hub Documentation" data-md-component="logo">
      
  <img src="../img/brh-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Biomedical Research Hub Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Nextflow - Upload Docker Image
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="brh_platform" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="brh_platform_dark" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 9a3 3 0 0 1 3 3 3 3 0 0 1-3 3 3 3 0 0 1-3-3 3 3 0 0 1 3-3m0-4.5c5 0 9.27 3.11 11 7.5-1.73 4.39-6 7.5-11 7.5S2.73 16.39 1 12c1.73-4.39 6-7.5 11-7.5M3.18 12a9.821 9.821 0 0 0 17.64 0 9.821 9.821 0 0 0-17.64 0Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/uc-cdis/BRH-documentation" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Biomedical Research Hub Documentation" class="md-nav__button md-logo" aria-label="Biomedical Research Hub Documentation" data-md-component="logo">
      
  <img src="../img/brh-logo.png" alt="logo">

    </a>
    Biomedical Research Hub Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/uc-cdis/BRH-documentation" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="https://brh.data-commons.org/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Return to BRH Platform
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../01-home/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    How to Get Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            How to Get Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../04-BRH_overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quickstart - BRH Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../05-workspace_registration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Workspace Page (Registration)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../06-loginoverview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Login Page
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../07-how_to_check_request_access/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Check Study Access and Authorize Resources
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../08-discovery_page/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Discovery Page
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../10-profile_page/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Profile Page
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Workspace User Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Workspace User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../09-workspace_page/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started in Workspace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../13-workspace_accounts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Workspace Accounts - Trial and Persistent Pay Models (STRIDES, Direct Pay)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../14-lauch_with_persistent_paymodel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Launch a Workspace with a Persistent Pay Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../15-monitor_compute_usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monitor Compute Usage in Persistent Pay Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../16-usage_exceeds_funding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    If Compute Usage Exceeds Funding
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../11-downloading_data_files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Downloading Data Files
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../17-workspace_faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Workspace FAQ
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Nextflow User Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Nextflow User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../nextflow-getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nextflow - Getting Started
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../nextflow-overview-containers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nextflow - Containers in Gen3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../nextflow-create-docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nextflow - Create Dockerfile
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../nextflow-request-creds/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nextflow - Request Credentials
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Nextflow - Upload Docker Image
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Nextflow - Upload Docker Image
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-note-about-timing" class="md-nav__link">
    A note about timing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-note-about-security-and-expiration-of-approved-docker-images" class="md-nav__link">
    A note about security and expiration of approved Docker images
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-aws-environment-variables" class="md-nav__link">
    Set AWS environment variables:
  </a>
  
    <nav class="md-nav" aria-label="Set AWS environment variables:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#verify-configuration" class="md-nav__link">
    Verify configuration:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authenticate-docker-to-ecr" class="md-nav__link">
    Authenticate Docker to ECR
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparing-to-push-your-docker-image" class="md-nav__link">
    Preparing to push your Docker image
  </a>
  
    <nav class="md-nav" aria-label="Preparing to push your Docker image">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#if-you-already-built-a-local-docker-image-tag-your-docker-image" class="md-nav__link">
    If you already built a local Docker image: Tag your Docker image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#if-you-need-to-build-your-docker-image" class="md-nav__link">
    If you need to build your Docker image:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#push-the-docker-image-to-the-ecr" class="md-nav__link">
    Push the Docker image to the ECR
  </a>
  
    <nav class="md-nav" aria-label="Push the Docker image to the ECR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#completion" class="md-nav__link">
    Completion
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-use-an-approved-docker-uri" class="md-nav__link">
    How to use an approved Docker URI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#support" class="md-nav__link">
    Support
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../nextflow-tutorial-workflows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nextflow - Tutorials Workflows
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../02-types_of_shared_data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAIR Data
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../03-data_and_repos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Management and Repositories
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../12-contact/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contact
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-note-about-timing" class="md-nav__link">
    A note about timing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-note-about-security-and-expiration-of-approved-docker-images" class="md-nav__link">
    A note about security and expiration of approved Docker images
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-aws-environment-variables" class="md-nav__link">
    Set AWS environment variables:
  </a>
  
    <nav class="md-nav" aria-label="Set AWS environment variables:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#verify-configuration" class="md-nav__link">
    Verify configuration:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authenticate-docker-to-ecr" class="md-nav__link">
    Authenticate Docker to ECR
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparing-to-push-your-docker-image" class="md-nav__link">
    Preparing to push your Docker image
  </a>
  
    <nav class="md-nav" aria-label="Preparing to push your Docker image">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#if-you-already-built-a-local-docker-image-tag-your-docker-image" class="md-nav__link">
    If you already built a local Docker image: Tag your Docker image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#if-you-need-to-build-your-docker-image" class="md-nav__link">
    If you need to build your Docker image:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#push-the-docker-image-to-the-ecr" class="md-nav__link">
    Push the Docker image to the ECR
  </a>
  
    <nav class="md-nav" aria-label="Push the Docker image to the ECR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#completion" class="md-nav__link">
    Completion
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-use-an-approved-docker-uri" class="md-nav__link">
    How to use an approved Docker URI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#support" class="md-nav__link">
    Support
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<div><p><a href="https://www.nextflow.io/"><img alt="Nextflow logo" src="../img/nextflow.svg" style="height:75px"></a></p>
<h1 id="pushing-docker-images-to-aws-ecr"><strong>Pushing Docker Images to AWS ECR</strong><a class="headerlink" href="#pushing-docker-images-to-aws-ecr" title="Permanent link">¶</a></h1>
<h3 id="overview"><strong>Overview</strong><a class="headerlink" href="#overview" title="Permanent link">¶</a></h3>
<p>This guide is for users who have received temporary credentials granting access to push container images to a specific AWS Elastic Container Registry (ECR) repository.</p>
<h3 id="prerequisites"><strong>Prerequisites</strong><a class="headerlink" href="#prerequisites" title="Permanent link">¶</a></h3>
<ul>
<li><a href="https://www.docker.com/get-started/">Docker</a> installed on your local machine.</li>
<li><a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html">AWS CLI</a> installed locally</li>
<li>Temporary AWS credentials provided by the User Services team.</li>
<li>The URI of the ECR repository you have been given access to (shared in the AWS credentials)</li>
<li>A image you want to push, or a Dockerfile to build your image.</li>
</ul>
<h3 id="a-note-about-timing"><strong>A note about timing</strong><a class="headerlink" href="#a-note-about-timing" title="Permanent link">¶</a></h3>
<p>Your temporary AWS credentials only lasts for 1 hour from when they were created; User Services should have provided an expiration time when sharing the credentials with you. You must fully complete the push to ECR before they expire, or you will need to request new credentials from User Services.</p>
<p>If you do <strong>not</strong> complete pushing an image to the ECR before they expire, please ping <code>@Sara Volk de Garcia</code> in Slack so she knows not to monitor for an image to progress through scanning.</p>
<h3 id="a-note-about-security-and-expiration-of-approved-docker-images"><strong>A note about security and expiration of approved Docker images</strong><a class="headerlink" href="#a-note-about-security-and-expiration-of-approved-docker-images" title="Permanent link">¶</a></h3>
<p>Because of the ever-updating nature of vulnerability detection, an image that has passed in the past is not guaranteed to always pass. Even if you are resumitting an image that has passed previously, there may be new vulnerabilities that have been reported that mean the image does not pass now. Best practices for most efficient submission are to always <a href="../nextflow-create-docker/#run-docker-scout">examine an image with Docker Scout</a> before pushing it.  </p>
<p>Similarly, because new vulnerabilities are always emerging, to protect the security of the Gen3 Workspace, approved containers will only remain available in the approved repo for 30 days. However, users can always request new credentials and resubmit their image for scanning.</p>
<h2 id="set-aws-environment-variables"><strong>Set AWS environment variables:</strong><a class="headerlink" href="#set-aws-environment-variables" title="Permanent link">¶</a></h2>
<p><em>The commands in this section are valid if you are using a Linux or MacOS. If you are using Windows, we will provide a separate set of commands for you to set the AWS environment variables.</em></p>
<p>Before you can push your Docker image to the ECR repository, you need to configure the AWS CLI with the temporary credentials you received. In the credentials sent to you, there should be the commands needed to run this below the line "Please run the following commands to set your AWS credentials:". Copy those (they will look similar to the block below) and run them in the terminal.</p>
<pre><code>  export AWS_ACCESS_KEY_ID=&lt;AccessKeyId&gt;
  export AWS_SECRET_ACCESS_KEY=&lt;SecretAccessKey&gt;
  export AWS_SESSION_TOKEN=&lt;SessionToken&gt;
</code></pre>
<blockquote>
<p>Note: the variables are set only as long as the terminal is open; export the variables again if you close and open a new terminal.</p>
</blockquote>
<h3 id="verify-configuration"><strong>Verify configuration:</strong><a class="headerlink" href="#verify-configuration" title="Permanent link">¶</a></h3>
<p>Run <code>aws sts get-caller-identity</code> to verify that your CLI is using the temporary credentials. If you successfully set the variables, you should see output showing the AWS information - UserID, account, etc.</p>
<h3 id="authenticate-docker-to-ecr"><strong>Authenticate Docker to ECR</strong><a class="headerlink" href="#authenticate-docker-to-ecr" title="Permanent link">¶</a></h3>
<p>Next, use the AWS CLI to retrieve an authentication token and authenticate your Docker client to your registry. In the credentials, there is a command below the line "After setting credentials you will need to log in to your docker registry. Please run the following command:". Copy that (it will look similar to the command below) and run it in the terminal.</p>
<pre><code> aws ecr get-login-password --region &lt;region&gt; | docker login --username AWS --password-stdin &lt;repositoryUri&gt;
</code></pre>
<h2 id="preparing-to-push-your-docker-image"><strong>Preparing to push your Docker image</strong><a class="headerlink" href="#preparing-to-push-your-docker-image" title="Permanent link">¶</a></h2>
<p>The specific steps you use to prepare to push your image depends on whether you have an image already built or if you will need to build from a Dockerfile.</p>
<h3 id="if-you-already-built-a-local-docker-image-tag-your-docker-image"><strong>If you already built a local Docker image: Tag your Docker image</strong><a class="headerlink" href="#if-you-already-built-a-local-docker-image-tag-your-docker-image" title="Permanent link">¶</a></h3>
<p>If you already have a locally-built Docker image, you will not need to run the <code>docker build</code> command included in the credentials. But, you do need to tag it with the ECR repository URI and the image tag you want to use. <em>This command is not in the credentials file.</em>  </p>
<pre><code> docker tag &lt;local-image&gt;:&lt;local-tag&gt; &lt;repositoryUri&gt;:&lt;image-tag&gt;
</code></pre>
<p>Replace <code>&lt; local-image &gt;</code> with the name of your local Docker image and <code>&lt; local-tag &gt;</code> with the tag you want to push.</p>
<blockquote>
<p>If you're not sure what your local image and tag names are, you can run <code>docker images</code> in your terminal. It will provide a list of all your saved docker images. The column called <code>REPOSITORY</code> is the local image name. The column called <code>TAG</code> is the local tag name for this image.<br>
Note: the <code>image-tag</code> you select will travel with your image to the approved repo. So, select a tag you are comfortable with.</p>
</blockquote>
<p>Replace <code>&lt; repositoryUri &gt;</code> with the ECR repository URI provided at the top of the credentials file, and <code>&lt; image-tag &gt;</code> with the image tag name you want to use in your ECR.</p>
<blockquote>
<p>Important note: If you do not want the most-recently-pushed image to replace an earlier version with the same tag in your ECR, image-tags should be unique.<br>
For example, you create an image with an image-tag <code>batch-poc</code>. If you later push another image to <code>&lt; repositoryUri &gt;:batch-poc</code>, it will overwrite the previous version of the image in your ECR (you will only have 1 container with the image tag "batch-poc").<br>
If you do not want to overwrite, you can use versioned image-tags. For example: <code>batch-poc-1.0</code>, and then <code>batch-poc-1.1</code>.<br>
If you want to replace previous versions of your container, you can use the same image-tag.  </p>
</blockquote>
<h3 id="if-you-need-to-build-your-docker-image"><strong>If you need to build your Docker image:</strong><a class="headerlink" href="#if-you-need-to-build-your-docker-image" title="Permanent link">¶</a></h3>
<p>If you haven't already built your Docker image, you can use the <code>docker build</code> command that is included in your credentials, similar to what is shown below. Note that you should run this command from the directory holding your Dockerfile. You will need to replace the <code>&lt; tag &gt;</code> in your command with the image tag name you want to use in your ECR. (Read more about image tags in the previous section.)</p>
<pre><code> docker build -t &lt;repositoryUri&gt;:&lt;tag&gt;
</code></pre>
<blockquote>
<p>If you use this <code>docker build</code> command from your credentials, you do not need to use the <code>docker tag</code> command (described in the previous section).  </p>
</blockquote>
<h2 id="push-the-docker-image-to-the-ecr"><strong>Push the Docker image to the ECR</strong><a class="headerlink" href="#push-the-docker-image-to-the-ecr" title="Permanent link">¶</a></h2>
<p>Push the tagged image to the ECR repository. The <code>docker push</code> command is also in the credentials - you just need to specify the image tag you selected when either tagging or building the image in the previous section.  </p>
<pre><code> docker push &lt;repositoryUri&gt;:&lt;image-tag&gt;
</code></pre>
<p>If the <strong>push is successful</strong>, you will see various "layer 1" "layer 2" etc outputs, and it will indicate progress in pushing. This can take minutes, depending on how large your container is.  </p>
<p>If the <strong>push fails</strong>, you will get a persistent message about "Waiting for layer". This usually means it cannot find the repository, so double-check that there is no typo, and that you have set your <a href="#set-aws-environment-variables">AWS environment variables</a> since you opened the terminal most recently.  </p>
<h3 id="completion"><strong>Completion</strong><a class="headerlink" href="#completion" title="Permanent link">¶</a></h3>
<p>Once the push completes, your Docker image will be available in the ECR repository (although you will not be able to see it). It will be scanned, and if passes the security scanning, CTDS will move it to the nextflow-approved repo. When it's available in nextflow-approved, User Services will share a docker URI that looks something like this:<br>
<code>143731057154.dkr.ecr.us-east-1.amazonaws.com/nextflow-approved/&lt; your username &gt;:&lt; image-tag &gt;</code><br>
You can then use this new URI to run Nextflow workflows with your container in the BRH workspace. (Note that you need to copy the whole URI into the container field of the nextflow notebook, as described <a href="#how-to-use-an-approved-docker-uri">in the next section</a>.)</p>
<h2 id="how-to-use-an-approved-docker-uri"><strong>How to use an approved Docker URI</strong><a class="headerlink" href="#how-to-use-an-approved-docker-uri" title="Permanent link">¶</a></h2>
<p>Once you have your Docker URI, you are ready to run your Nextflow workflow! You can take the Docker URI (copy the entire line) and make it the value for the "container" field(s) in your Nextflow notebook. For example, in the <code>torch_cuda_batch</code> <a href="https://github.com/uc-cdis/bio-nextflow/blob/master/nextflow_notebooks/containerized_gpu_workflows/torch_cuda_test/torch_cuda_batch_template.ipynb">Nextflow notebook</a>, you would go to the <code>nextflow.config</code> section and replace the <code>placeholder</code> value for <code>container</code> with the approved Docker URI.  </p>
<p>Please note that you will need to replace all <code>placeholder</code> values in the <code>nextflow.config</code> with values specific to your workspace. Please see the section <a href="../nextflow-tutorial-workflows/#get-and-replace-placeholder-values-from-the-nextflow-config">"Get and replace placeholder values from the Nextflow config"</a> on the Tutorials page for more information.</p>
<p><img alt="Screenshot of nextflow.config, showing where you put the Docker URI" src="../img/nextflow-config.png"></p>
<h2 id="support"><strong>Support</strong><a class="headerlink" href="#support" title="Permanent link">¶</a></h2>
<p>If you encounter any issues or require assistance, please reach out to the User Services team that provided you with the temporary credentials, or <a href="mailto:brhsupport@datacommons.io">brhsupport@datacommons.io</a>, or reach out on Slack. (Slack will result in the quickest reply.)</p>
<p><a href="../nextflow-tutorial-workflows/"><em>Continue to Tutorial Workflows</em></a></p></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.indexes", "navigation.tracking"], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.aecac24b.min.js"></script>
      
    
  </body>
</html>